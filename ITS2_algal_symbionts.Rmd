
---
title: "ITS2_algal_symbionts"
output: html_notebook
editor_options: 
  chunk_output_type: console
chunk_output_type: console
---
This is from the Microbial Landscape experiment (summer 2019). ITS2 data from Symportal pipeline. 
Last updated:20220622
test

#Analysis
```{r} 

library(janitor)
library(phyloseq)  # source('http://bioconductor.org/biocLite.R'); biocLite('phyloseq')
library(zoo)
library(stringr)
library(vegan)
library(multcompView)
library("ggpubr")
library(tidyverse)
 
#load("ITS2_Summer_symportal2020/data/coral_phyloseq_2022.RData") # Rel A data
#load("ITS2_Summer_symportal2020/data/Absolute_coral_phyloseq2022.RData") #absolute reads data

```

Use: coral_absolutePro and coral_Absolute_DIV to create your RelA dfs

Data wrangle: look at low samples
```{r} 
#lets see what is up with the low samps

LowSamps<-readxl::read_xlsx("/Users/shaylematsuda/Desktop/Projects/Mcapitata_microbial_landscape/ITS2_Summer_symportal2020/20201214_matsuda_MCL/post_med_seqs/133_20201216_DBV_20201216T011417.seqs.absolute.meta_only.xlsx")

LowSamps$post_taxa_id_absolute_symbiodiniaceae_seqs_log<-log10(LowSamps$post_taxa_id_absolute_symbiodiniaceae_seqs)
hist(LowSamps$post_taxa_id_absolute_symbiodiniaceae_seqs_log, breaks=20)

```
Look at the low samples: no patterns 
```{r} 
sample_names(coral_Absolute_DIV) #print sample names

#look at NTCs
#Negative Controls
  NTCtest <- subset_samples(coral_Absolute_DIV, collection_latitude =="NTC"| collection_latitude =="NTC2") #subset multiple samples
   NTCtest.prune <- prune_taxa(taxa_sums(NTCtest) >0, NTCtest)
     plot_bar(NTCtest.prune,fill = "DIV")+
      geom_bar(aes(color=DIV, fill=DIV), stat="identity", position="stack")
     
#Samples under 2000 hits 
LOWtest <- subset_samples(coralDIV2, Sample_name =="S6"| Sample_name =="G7"|Sample_name =="Q11"|Sample_name =="G8"|Sample_name =="B13"|Sample_name =="B6"|Sample_name =="C14") #subset multiple samples
   LOWtest.prune <- prune_taxa(taxa_sums(LOWtest) >0, LOWtest) # prune all 0s
     
   plot_bar(LOWtest.prune,fill = "DIV")+                     # plot DIVS
    geom_bar(aes(color=DIV, fill=DIV), stat="identity", position="stack")
     
   plot_bar(LOWtest.prune,fill = "clade")+                     # plot Clades
      geom_bar(aes(color=clade, fill=clade), stat="identity", position="stack")
   
     readcount(LOWtest.prune)
```
 
Remove low samples from the datasets (less than 2000)
coral_absolutePro
coral_Absolute_DIV
```{r} 
#DIVs 
to_remove <- c("NTC", "NTC2", "S6", "G7","Q11","G8", "B13","B6","C14") #make list of samples to remove with less than 2000 seqs
coral_Absolute_DIV2.prune <- prune_samples(!(sample_names(coral_Absolute_DIV) %in% to_remove), coral_Absolute_DIV) #remove
#sample_names(coralDIV2.prune) # check to see they are removed

#Pros
to_remove <- c("NTC", "NTC2", "S6", "G7","Q11","G8", "B13","B6", "C14") #make list of samples to remove with less than 2000 seqs
coral_absolutePro.prune <- prune_samples(!(sample_names(coral_absolutePro) %in% to_remove), coral_absolutePro) #remove
#sample_names(coral2.prune) # check to see they are removed

```

# DIVs examine data and clean up
```{r}
## check out data
ntaxa(coral_Absolute_DIV2.prune)  #num taxa
nsamples(coral_Absolute_DIV2.prune)   #num samples
sample_names(coral_Absolute_DIV2.prune)[1:5] #samp names
rank_names(coral_Absolute_DIV2.prune) #ranks are DIV and clade
sample_variables(coral_Absolute_DIV2.prune) #all metadata cats

# create df of sample data to view 
sample.data <- as(sample_data(coral_Absolute_DIV2.prune), "data.frame") #create sample data frame to view
sample.data$LibrarySize <- sample_sums(coral_Absolute_DIV2.prune)
sample.data <- sample.data[order(sample.data$LibrarySize),]
sample.data$Index <- seq(nrow(sample.data))
ggplot(data = sample.data, aes(x=Index, y=LibrarySize, color = sample_type)) +
  geom_point()
```

Making rare and non-rare dataframes
```{r}
#DIVs
#make a non-rarefied df:
#Remove all samples with <2000 reads and create sample data
#These data also useful for beta diversity analyses (non-rarefied)
coral_Absolute_DIV2.prune_nonrare <- prune_samples(sample_sums(coral_Absolute_DIV2.prune)>=2000, coral_Absolute_DIV2.prune) # remove samps <2000, save as new obj
coral_Absolute_DIV2.prune_nonrare_sd <- as(sample_data(coral_Absolute_DIV2.prune_nonrare), "data.frame")


#Make a rarefied phyloseq object for alpha diversity analyses
coral_Absolute_DIV2.rare <- rarefy_even_depth(coral_Absolute_DIV2.prune, sample.size = 2000, rngseed = 711)   #C14 sample removedbc less than 2000 
sample_sums(coral_Absolute_DIV2.rare) #Double check that the sub-sampling worked, this should report 2000 for each sample
coralDIV2.rare <- as(sample_data(coral_Absolute_DIV2.rare), "data.frame")
coralDIV2.rare



#Rareify Profiles/Clades coral_absolutePro.prune
coral_Absolute_Pro.rare <- rarefy_even_depth(coral_absolutePro.prune, sample.size = 1600, rngseed = 711)   #C14 sample removedbc less than 2000 
sample_sums(coral_Absolute_Pro.rare) #Double check that the sub-sampling worked, this should report 2000 for each sample
coralPro.rare <- as(sample_data(coral_Absolute_Pro.rare), "data.frame")
coralPro.rare



```

Turn rarified df in to relative abundance: coral_Absolute_DIV2.rare 
```{r}
#RELA 
DIV_RelA  = transform_sample_counts(coral_Absolute_DIV2.rare, function(x) x / sum(x) )  #save as RELA DIVs
data.ra <- as(sample_data(DIV_RelA), "data.frame") #look at samp data
#write.csv(data.ra, "DIV_its2_sampledata.csv")

   DIV_RelA = prune_taxa(taxa_sums(DIV_RelA) > 0, DIV_RelA) #this removes any OTU with 0s
   
 #Pro_RelA
Pro_RelA  = transform_sample_counts(coral_Absolute_Pro.rare, function(x) x / sum(x) )  #save as RELA DIVs
data.ra <- as(sample_data(Pro_RelA), "data.frame") #look at samp data
#write.csv(data.ra, "DIV_its2_sampledata.csv")

   Pro_RelA = prune_taxa(taxa_sums(Pro_RelA) > 0, Pro_RelA) #this removes any OTU with 0s  
  
```

# Side note: get %C and %D for each sample (telomere data as well) df Pro_RelA
Export the csv and add in metadata col in the ITS2 Symp to Phyloseq.RMD
Pro_RelA2 df has all samples (even low count samples not used in ITS2 analysis)
```{r}
#do tax glom in the data to group C and D
 data.clade<- tax_glom(Pro_RelA, taxrank="clade")

#coerce into df
  # Extract abundance matrix from the phyloseq object
  OTU1 = as(otu_table(data.clade), "matrix")
  # transpose if necessary
  if(taxa_are_rows(data.clade)){OTU1 <- t(OTU1)}
  # Coerce to data.frame
  OTUdf = as.data.frame(OTU1)

  library(tidyverse)
library(tibble)

OTUdf <- tibble::rownames_to_column(OTUdf, "sample.name")
as_tibble(OTUdf)

OTUdf<-OTUdf%>%
  dplyr::rename(C1 = 2,
  C2 = 3,
  D2 = 4,
  D1 = 5) 
  


OTUdf<-
  OTUdf %>% rowwise() %>%
  mutate(Prop.C = sum(c(C1+C2))) %>%  #sum C
    mutate(Prop.D = sum(c(D1+D2)))   #sum D

OTUdf<-OTUdf %>%
    mutate(samp.num = as.numeric(str_extract(sample.name, "[0-9]+"))) %>%   #extract number in samp name
      mutate(samp.let = as.character(str_extract(sample.name, "[A-Z]+")))   # extract letter in samp name
#Next enter genotype letter combo

OTUdf<-OTUdf%>%
  rowwise() %>%
      mutate(
        C = sum(c_across(2:3)),
        D = sum(c_across(4:5)))

OTUdf.PropCD<-OTUdf[,c("sample.name","Prop.C", "Prop.D")]
head(OTUdf.PropCD)
OTUdf.PropCD<-dplyr::rename(OTUdf.PropCD,  sample_name=sample.name)
#write.csv(OTUdf.PropCD,"propCD.csv")







##Low samps only ####

#get the clade-only level designation for the low samples to use in 16S. these are not used for the ITS2 DIVs or further clade
#get prop CD for all samples JUST for genus designation DF coral_absolutePro

#Profile samples removed due to low counts. S6, G7, G8, Q11, B6, B13, C14
  #create phylo obj with just these samples
  new_phy_obj  <- coral_absolutePro %>%
    subset_samples(Sample_name %in% c("S6", "G7", "G13","Q11","G8", "B13","B6", "C14"))

sample_sums(new_phy_obj) #view sample sums
new_phy_obj_sd <- as(sample_data(new_phy_obj), "data.frame")
new_phy_obj_sd

#Pro_RelA JUST for PropCD designations df 
new_phy_objRA  = transform_sample_counts(new_phy_obj, function(x) x / sum(x) )  #save as RELA DIVs
new_phy_objRA2 <- as(sample_data(new_phy_objRA), "data.frame") #look at samp data
   new_phy_objRA = prune_taxa(taxa_sums(new_phy_objRA) > 0, new_phy_objRA) #this removes any OTU with 0s  

#do tax glom in the data to group C and D
 data.cladeL<- tax_glom(new_phy_objRA, taxrank="clade")

#coerce into df
  # Extract abundance matrix from the phyloseq object
  OTU1 = as(otu_table(data.cladeL), "matrix")
  # transpose if necessary
  if(taxa_are_rows(data.cladeL)){OTU1 <- t(OTU1)}
  # Coerce to data.frame
  OTUdf = as.data.frame(OTU1)

OTUdf <- tibble::rownames_to_column(OTUdf, "sample.name")
as_tibble(OTUdf)

OTUdf<-OTUdf%>%
  dplyr::rename(C = 2,  #no C2 in these samples
  D = 3) 

#write.csv(OTUdf,"propCD_lowSamps.csv")


```


# make distance matrix
(Code from TT17)
```{r}
#make bray curtis data matrix
  DIV_RelA.dist <- phyloseq::distance(DIV_RelA, method = "bray")
  samp.DIV_RelA.dist <- as(sample_data(DIV_RelA), "data.frame") #sample df

  samp.DIV_RelA.dist$Prop.D<-as.numeric(samp.DIV_RelA.dist$Prop.D)
    samp.DIV_RelA.dist$Prop.C<-as.numeric(samp.DIV_RelA.dist$Prop.C)
  samp.DIV_RelA.dist$Location<-as.factor(samp.DIV_RelA.dist$Location)
  samp.DIV_RelA.dist$LocSamp<-as.factor(samp.DIV_RelA.dist$LocSamp)
  samp.DIV_RelA.dist$TagID<-as.factor(samp.DIV_RelA.dist$TagID)

  
#adonis by colony level
  set.seed(30)
  adonis2(DIV_RelA.dist ~ TagID, data = samp.DIV_RelA.dist)
  set.seed(30)
  adonis2(DIV_RelA.dist ~ Prop.D, data = samp.DIV_RelA.dist)
    

# Homogeneity of dispersion test
  betaTagID <- betadisper(DIV_RelA.dist, samp.DIV_RelA.dist$TagID)
  perm<-permutest(betaTagID, pairwise = T) 
  (betaTagID.HSD <- TukeyHSD(betaTagID)) #do you need? impossible to visualize
  plot(betaTagID.HSD)

#adonis by sample location and colony ID
  adonis2(DIV_RelA.dist ~ Location*TagID, data = samp.DIV_RelA.dist)
     set.seed(30)
 # Homogeneity of dispersion test, Location
  betaTagID <- betadisper(DIV_RelA.dist, samp.DIV_RelA.dist$Location)
  perm<-permutest(betaTagID, pairwise = T) 

#adonis by broad location and colony ID
  adonis2(DIV_RelA.dist ~ SampLoc*TagID, data = samp.DIV_RelA.dist)

#anova is location a predictor of propD <- does this work?
    aov.propD = aov(Prop.D ~ TagID*Location, data=samp.DIV_RelA.dist)
    summary(aov.propD) # only location sig
TukeyHSD(aov.propD)



  
set.seed(30)
ord.DIV_RelA.dist<- ordinate(DIV_RelA, "NMDS", "bray", trymax = 100) 
stressplot(ord.DIV_RelA.dist)
scores.ord.DIV_RelA.dist <- as.data.frame(cbind(vegan::scores(ord.DIV_RelA.dist, display="sites"))) #make df
scores.ord.DIV_RelA.dist$TagID <- samp.DIV_RelA.dist$TagID
scores.ord.DIV_RelA.dist$col.branch <- samp.DIV_RelA.dist$col.branch
scores.ord.DIV_RelA.dist$Location <- samp.DIV_RelA.dist$Location
scores.ord.DIV_RelA.dist$Zoox <- samp.DIV_RelA.dist$Zoox


ggplot(scores.ord.DIV_RelA.dist, aes(x = NMDS1, y = NMDS2)) + 
  geom_point(aes(colour = TagID), size = 4,show.legend=T) +
  # scale_color_manual(values=Sp.colors)+
  # geom_text(label = rownames(Clade), nudge_x = 0.05, nudge_y = 0.05,check_overlap = T) +
  stat_ellipse(aes(x = NMDS1, y = NMDS2, colour = TagID), linetype = 2,show.legend=F) +
  ggtitle("NMDS its2 Bray Curtis TagID") +
  theme_classic()
  #facet_wrap(~Zoox)
#ggsave("NMDS_ITS2_allsamps.pdf")  
  
 ### plot by Proportion D ##############3

 #Color points by proportion of D
  library(ecodist)
  bray_pcoa <- ecodist::pco(DIV_RelA.dist)
bray_pcoa_df <- data.frame(pcoa1 = bray_pcoa$vectors[,1],
                           pcoa2 = bray_pcoa$vectors[,2])
head(bray_pcoa_df)
bray_pcoa_df$Prop.D <- samp.DIV_RelA.dist$Prop.D
bray_pcoa_df$Prop.D<-as.numeric(bray_pcoa_df$Prop.D)
bray_pcoa_df$TagID <-samp.DIV_RelA.dist$TagID
bray_pcoa_df$Location <-samp.DIV_RelA.dist$Location

pcoa <- ggplot(bray_pcoa_df, aes(x=pcoa1, y=pcoa2, color = Prop.D)) + 
  geom_point(size = 3,show.legend = F) +
  labs(x = "PC1",
       y = "PC2",
       title = "PCoA of ITS2 vs PropD") +
  theme_bw();pcoa
  
#same by genotype (for slides)

library(tidyverse)
library(qualpalr) #generate diverging colors
pal = qualpal(24, colorspace=list(h=c(10,350), s=c(0.3,1), l=c(0.2,0.8)))


  pcoa <- ggplot(bray_pcoa_df, aes(x=pcoa1, y=pcoa2, color = TagID)) + 
  geom_point(size = 3,show.legend = F) +
    scale_color_manual(values=pal$hex)+
  labs(x = "PC1",
       y = "PC2",
       title = "PCoA of ITS2 vs PropD") +
  theme_bw();pcoa

  #same by location (for slides)
  pcoa <- ggplot(bray_pcoa_df, aes(x=pcoa1, y=pcoa2, color = Location)) + 
  geom_point(size = 3,show.legend = F) +
  labs(x = "PC1",
       y = "PC2",
       title = "PCoA of ITS2 vs PropD") +
  theme_bw();pcoa
  
```  
  
 Split into C-, D-, CD <-what is the deciding factor??? 
```{r}  
# Split into groups of CD, C and D only ####
#C only

#adonis by colony by sample location by branch/plate 
  C.DIV_RelA.dist <- subset_samples(DIV_RelA, Zoox =="C") #Subset by colony 
  C.DIV_RelA.dist = prune_taxa(taxa_sums(C.DIV_RelA.dist) > 0, C.DIV_RelA.dist) #this removes any OTU with 0s

  C.DIV_RelA.dist.dist <- phyloseq::distance(C.DIV_RelA.dist, method = "bray")
  samp.C.DIV_RelA.dist.dist <- as(sample_data(C.DIV_RelA.dist), "data.frame") #sample df
  
#adonis 
  set.seed(30)
  adonis2(C.DIV_RelA.dist.dist ~ TagID, data = samp.C.DIV_RelA.dist.dist)
    set.seed(30)
  adonis2(C.DIV_RelA.dist.dist ~ Location, data = samp.C.DIV_RelA.dist.dist)
    set.seed(30)
  adonis2(C.DIV_RelA.dist.dist ~ TagID*Location, data = samp.C.DIV_RelA.dist.dist)

  set.seed(30)
ord.DIV_RelA.C.dist<- ordinate(C.DIV_RelA.dist, "NMDS", "bray", trymax = 100) 
stressplot(ord.DIV_RelA.C.dist)
scores.ord.DIV_RelA.C.dist <- as.data.frame(cbind(vegan::scores(ord.DIV_RelA.C.dist, display="sites"))) #make df
scores.ord.DIV_RelA.C.dist$TagID <- samp.C.DIV_RelA.dist.dist$TagID
scores.ord.DIV_RelA.C.dist$col.branch <- samp.C.DIV_RelA.dist.dist$col.branch
scores.ord.DIV_RelA.C.dist$Location <- samp.C.DIV_RelA.dist.dist$Location

a<-ggplot(scores.ord.DIV_RelA.C.dist, aes(x = NMDS1, y = NMDS2)) + 
  geom_point(aes(colour = TagID), size = 4,show.legend=T) +
  # scale_color_manual(values=Sp.colors)+
  # geom_text(label = rownames(Clade), nudge_x = 0.05, nudge_y = 0.05,check_overlap = T) +
  stat_ellipse(aes(x = NMDS1, y = NMDS2, colour = TagID), linetype = 2,show.legend=F) +
  ggtitle("NMDS its2 Bray Curtis TagID C-only") +
  theme_classic();a
#ggsave("bc_all.pdf")

#D only

#adonis by colony by sample location by branch/plate
  D.DIV_RelA.dist <- subset_samples(DIV_RelA, Zoox =="D") #Subset by colony 
  D.DIV_RelA.dist = prune_taxa(taxa_sums(D.DIV_RelA.dist) > 0, D.DIV_RelA.dist) #this removes any OTU with 0s

  D.DIV_RelA.dist.dist <- phyloseq::distance(D.DIV_RelA.dist, method = "bray")
  samp.D.DIV_RelA.dist.dist <- as(sample_data(D.DIV_RelA.dist), "data.frame") #sample df

#adonis
  samp.D.DIV_RelA.dist.dist$col.branch<-paste(samp.D.DIV_RelA.dist.dist$TagID,samp.D.DIV_RelA.dist.dist$branch.plate)
  set.seed(30)
  adonis2(D.DIV_RelA.dist.dist ~ TagID, data = samp.D.DIV_RelA.dist.dist)
   set.seed(30)
 adonis2(D.DIV_RelA.dist.dist ~ Location, data = samp.D.DIV_RelA.dist.dist)
    set.seed(30)
adonis2(D.DIV_RelA.dist.dist ~ TagID*Location, data = samp.D.DIV_RelA.dist.dist)


  set.seed(30)
ord.DIV_RelA.D.dist<- ordinate(D.DIV_RelA.dist, "NMDS", "bray", trymax = 100) 
stressplot(ord.DIV_RelA.D.dist)
scores.ord.DIV_RelA.D.dist <- as.data.frame(cbind(vegan::scores(ord.DIV_RelA.D.dist, display="sites"))) #make df
scores.ord.DIV_RelA.D.dist$TagID <- samp.D.DIV_RelA.dist.dist$TagID
scores.ord.DIV_RelA.D.dist$col.branch <- samp.D.DIV_RelA.dist.dist$col.branch
scores.ord.DIV_RelA.D.dist$Location <- samp.D.DIV_RelA.dist.dist$Location

b<-ggplot(scores.ord.DIV_RelA.D.dist, aes(x = NMDS1, y = NMDS2)) + 
  geom_point(aes(colour = TagID), size = 4,show.legend=T) +
  # scale_color_manual(values=Sp.colors)+
  # geom_text(label = rownames(Clade), nudge_x = 0.05, nudge_y = 0.05,check_overlap = T) +
  stat_ellipse(aes(x = NMDS1, y = NMDS2, colour = TagID), linetype = 2,show.legend=F) +
  ggtitle("NMDS its2 Bray Curtis TagID D-only") +
  theme_classic();b
#ggsave("bc_all.pdf")

#CD only

#adonis by colony by sample location by branch/plate
  CD.DIV_RelA.dist <- subset_samples(DIV_RelA, Zoox =="CD") #Subset by colony 
  CD.DIV_RelA.dist = prune_taxa(taxa_sums(CD.DIV_RelA.dist) > 0, CD.DIV_RelA.dist) #this removes any OTU with 0s

  CD.DIV_RelA.dist.dist <- phyloseq::distance(CD.DIV_RelA.dist, method = "bray")
  samp.CD.DIV_RelA.dist.dist <- as(sample_data(CD.DIV_RelA.dist), "data.frame") #sample df

#adonis by colony level by branch
  samp.CD.DIV_RelA.dist.dist$col.branch<-paste(samp.CD.DIV_RelA.dist.dist$TagID,samp.CD.DIV_RelA.dist.dist$branch.plate)
  
  set.seed(30)
  adonis2(CD.DIV_RelA.dist.dist ~ TagID, data = samp.CD.DIV_RelA.dist.dist)
    set.seed(30)
adonis2(CD.DIV_RelA.dist.dist ~ Location, data = samp.CD.DIV_RelA.dist.dist)
    set.seed(30)
adonis2(CD.DIV_RelA.dist.dist ~ TagID*Location, data = samp.CD.DIV_RelA.dist.dist)

  
  set.seed(30)
orCD.DIV_RelA.CD.dist<- ordinate(CD.DIV_RelA.dist, "NMDS", "bray", trymax = 100) 
stressplot(orCD.DIV_RelA.CD.dist)
scores.orCD.DIV_RelA.CD.dist <- as.data.frame(cbind(vegan::scores(orCD.DIV_RelA.CD.dist, display="sites"))) #make df
scores.orCD.DIV_RelA.CD.dist$TagID <- samp.CD.DIV_RelA.dist.dist$TagID
scores.orCD.DIV_RelA.CD.dist$col.branch <- samp.CD.DIV_RelA.dist.dist$col.branch
scores.orCD.DIV_RelA.CD.dist$Location <- samp.CD.DIV_RelA.dist.dist$Location
scores.orCD.DIV_RelA.CD.dist$SampLoc <- samp.CD.DIV_RelA.dist.dist$SampLoc
scores.orCD.DIV_RelA.CD.dist$Prop.D <- samp.CD.DIV_RelA.dist.dist$Prop.D


##can't figure out how to make this a gradient plot

c<-ggplot(scores.orCD.DIV_RelA.CD.dist, aes(x = NMDS1, y = NMDS2)) + 
  geom_point(aes(colour = Prop.D), size = 4,show.legend=T) +
  #scale_colour_brewer(palette = 1)  +
#geom_text(label = rownames(Clade), nudge_x = 0.05, nudge_y = 0.05,check_overlap = T) +
    # stat_ellipse(aes(group = TagID), colour = "black") +
  ggtitle("NMDS its2 Bray Curtis TagID CD-only") +
  theme_classic();c
#ggsave("bc_all.pdf")
  
  library(cowplot)

  plot_grid(a, b, c)

  #Color points by proportion of D
  library(ecodist)
  bray_pcoa <- ecodist::pco(CD.DIV_RelA.dist.dist)
bray_pcoa_df <- data.frame(pcoa1 = bray_pcoa$vectors[,1],
                           pcoa2 = bray_pcoa$vectors[,2])
head(bray_pcoa_df)
bray_pcoa_df$Prop.D <- samp.CD.DIV_RelA.dist.dist$Prop.D
bray_pcoa_df$Prop.D<-as.numeric(bray_pcoa_df$Prop.D)
bray_pcoa_df$TagID <-samp.CD.DIV_RelA.dist.dist$TagID
  bray_pcoa_df$Location <-samp.CD.DIV_RelA.dist.dist$Location

pcoa <- ggplot(bray_pcoa_df, aes(x=pcoa1, y=pcoa2, color = Prop.D)) + 
  geom_point(size = 3) +
  labs(x = "PC1",
       y = "PC2",
       title = "PCoA of ITS2 vs PropD") +
  theme_bw();pcoa
  
#same by genotype (for slides)
  pcoa <- ggplot(bray_pcoa_df, aes(x=pcoa1, y=pcoa2, color = TagID)) + 
  geom_point(size = 3) +
  labs(x = "PC1",
       y = "PC2",
       title = "PCoA of ITS2 vs PropD") +
  theme_bw();pcoa

  #same by location (for slides)
  pcoa <- ggplot(bray_pcoa_df, aes(x=pcoa1, y=pcoa2, color = Location)) + 
  geom_point(size = 3) +
  labs(x = "PC1",
       y = "PC2",
       title = "PCoA of ITS2 vs PropD") +
  theme_bw();pcoa
```

#subset only branches
```{r}
#adonis by colony by sample location by branch/plate
  Branch.only <- subset_samples(DIV_RelA, SampLoc =="Branch") #Subset by colony 
  Branch.only = prune_taxa(taxa_sums(Branch.only) > 0, Branch.only) #this removes any OTU with 0s

  Branch.only.dist <- phyloseq::distance(Branch.only, method = "bray")
  samp.Branch.only.dist <- as(sample_data(Branch.only), "data.frame") #sample df

#adonis by colony level
  set.seed(30)
  adonis2(Branch.only.dist ~ TagID*Sub.loc, data = samp.Branch.only.dist)
  
#adonis by colony level by branch
  samp.Branch.only.dist$col.branch<-paste(samp.Branch.only.dist$TagID,samp.Branch.only.dist$branch.plate)
  
    set.seed(30)
adonis2(Branch.only.dist ~ col.branch, data = samp.Branch.only.dist)
    set.seed(30)
  adonis2(Branch.only.dist ~ Sub.loc, data = samp.Branch.only.dist)
  
     set.seed(30)
  adonis2(Branch.only.dist ~ TagID+col.branch+Sub.loc, data = samp.Branch.only.dist)
    adonis2(Branch.only.dist ~ TagID:branch.plate+TagID*Sub.loc, data = samp.Branch.only.dist)


set.seed(300)
ord.Branch.only<- ordinate(Branch.only, "NMDS", "bray", trymax = 150) #no convergence
stressplot(ord.Branch.only)
scores.ord.ord.Branch.only <- as.data.frame(cbind(vegan::scores(ord.Branch.only, display="sites"))) #make df
scores.ord.ord.Branch.only$TagID <- samp.Branch.only.dist$TagID
scores.ord.ord.Branch.only$col.branch <- samp.Branch.only.dist$col.branch
scores.ord.ord.Branch.only$Location <- samp.Branch.only.dist$Location

ggplot(scores.ord.ord.Branch.only, aes(x = NMDS1, y = NMDS2)) + 
  geom_point(aes(colour = TagID), size = 4,show.legend=T) +
  # scale_color_manual(values=Sp.colors)+
  # geom_text(label = rownames(Clade), nudge_x = 0.05, nudge_y = 0.05,check_overlap = T) +
  stat_ellipse(aes(x = NMDS1, y = NMDS2, colour = TagID), linetype = 2,show.legend=F) +
  ggtitle("NMDS its2 Bray Curtis TagID") +
  theme_classic()
#ggsave("bc_all.pdf")


# Split into groups of CD, C and D only ####
#C only

#adonis by colony by sample location by branch/plate
  C.Branch.only <- subset_samples(Branch.only, Zoox =="C") #Subset by colony 
  C.Branch.only = prune_taxa(taxa_sums(C.Branch.only) > 0, C.Branch.only) #this removes any OTU with 0s

  C.Branch.only.dist <- phyloseq::distance(C.Branch.only, method = "bray")
  samp.C.Branch.only.dist <- as(sample_data(C.Branch.only), "data.frame") #sample df

#adonis by colony level
  adonis2(C.Branch.only.dist ~ TagID, data = samp.C.Branch.only.dist)
  
#adonis by colony level by branch
  samp.C.Branch.only.dist$col.branch<-paste(samp.C.Branch.only.dist$TagID,samp.C.Branch.only.dist$branch.plate)
  set.seed(30)
  adonis2(C.Branch.only.dist ~ col.branch, data = samp.C.Branch.only.dist)
  adonis2(C.Branch.only.dist ~ TagID, data = samp.C.Branch.only.dist)
  adonis2(C.Branch.only.dist ~ Sub.loc, data = samp.C.Branch.only.dist)

#D only

#adonis by colony by sample location by branch/plate
  D.Branch.only <- subset_samples(Branch.only, Zoox =="D") #Subset by colony 
  D.Branch.only = prune_taxa(taxa_sums(D.Branch.only) > 0, D.Branch.only) #this removes any OTU with 0s

  D.Branch.only.dist <- phyloseq::distance(D.Branch.only, method = "bray")
  samp.D.Branch.only.dist <- as(sample_data(D.Branch.only), "data.frame") #sample df

#adonis
  samp.D.Branch.only.dist$col.branch<-paste(samp.D.Branch.only.dist$TagID,samp.D.Branch.only.dist$branch.plate)
  
  adonis2(D.Branch.only.dist ~ col.branch, data = samp.D.Branch.only.dist)
  adonis2(D.Branch.only.dist ~ TagID, data = samp.D.Branch.only.dist)
  adonis2(D.Branch.only.dist ~ Sub.loc, data = samp.D.Branch.only.dist)

  
#CD only

#adonis by colony by sample location by branch/plate
  CD.Branch.only <- subset_samples(Branch.only, Zoox =="CD") #Subset by colony 
  CD.Branch.only = prune_taxa(taxa_sums(CD.Branch.only) > 0, CD.Branch.only) #this removes any OTU with 0s

  CD.Branch.only.dist <- phyloseq::distance(CD.Branch.only, method = "bray")
  samp.CD.Branch.only.dist <- as(sample_data(CD.Branch.only), "data.frame") #sample df

#adonis by colony level by branch
  samp.CD.Branch.only.dist$col.branch<-paste(samp.CD.Branch.only.dist$TagID,samp.CD.Branch.only.dist$branch.plate)
  
  adonis2(CD.Branch.only.dist ~ col.branch, data = samp.CD.Branch.only.dist)
  adonis2(CD.Branch.only.dist ~ TagID, data = samp.CD.Branch.only.dist)
    adonis2(CD.Branch.only.dist ~ Sub.loc, data = samp.CD.Branch.only.dist)

  adonis2(CD.Branch.only.dist ~ Sub.loc*TagID, data = samp.CD.Branch.only.dist)
  adonis2(CD.Branch.only.dist ~ TagID*Sub.loc, data = samp.CD.Branch.only.dist)

  
  
  
```  
  
  
  
  
  
  
#Ordination NMDS for all colonies <- dont need
```{r}
set.seed(30)
ord.DIV_RelA<- ordinate(DIV_RelA, "NMDS", "bray", trymax = 100) 
stressplot(ord.DIV_RelA)
scores.ord.DIV_RelA_stats.T0 <- as.data.frame(cbind(vegan::scores(ord.DIV_RelA, display="sites"))) #make df
scores.ord.DIV_RelA_stats.T0$TagID <- samp.DIV_RelA.dist$TagID
scores.ord.DIV_RelA_stats.T0$Samp.Date <- samp.DIV_RelA.dist$Samp.Date
scores.ord.DIV_RelA_stats.T0$Location <- samp.DIV_RelA.dist$Location

ggplot(scores.ord.DIV_RelA_stats.T0, aes(x = NMDS1, y = NMDS2)) + 
  geom_point(aes(colour = TagID), size = 4,show.legend=F) +
  #scale_color_manual(values=Sp.colors)+
  # geom_text(label = rownames(Clade), nudge_x = 0.05, nudge_y = 0.05,check_overlap = T) +
  stat_ellipse(aes(x = NMDS1, y = NMDS2, colour = TagID), linetype = 2,show.legend=F) +
  ggtitle("NMDS its2 Bray Curtis TagID") +
  theme_classic()
#ggsave("bc_all.pdf")

ggplot(scores.ord.DIV_RelA_stats.T0, aes(x = NMDS1, y = NMDS2)) + 
  geom_point(aes(colour = Location), size = 4, show.legend=T) +
  #scale_color_manual(values=Sp.colors)+
  #geom_text(label = rownames(scores), nudge_x = 0.05, nudge_y = 0.05,check_overlap = T) +
  stat_ellipse(aes(x = NMDS1, y = NMDS2, colour = Location), linetype = 2,show.legend=F) +
  ggtitle("NMDS its2 Bray Curtis Location") +
  theme_classic()
#ggsave("bc_all.pdf")


```

#Adonis within colony:
Subset by colony DIV, data setup
```{r} 
sample_variables(DIV_RelA) #what are the variables
  samp.DIV_RelA<- as(sample_data(DIV_RelA), "data.frame") #sample df
samp.DIV_RelA$Prop.D<-as.numeric(samp.DIV_RelA$Prop.D)



#970
Mcap_970 <- subset_samples(DIV_RelA, TagID =="970") #Subset by colony 
  Mcap_970.dist <- phyloseq::distance(Mcap_970, method = "bray")
  samp.Mcap_970<- as(sample_data(Mcap_970), "data.frame") #sample df
  
    #adonis by colony level
    adonis2(Mcap_970.dist ~ Location, data = samp.Mcap_970)

#965
Mcap_965 <- subset_samples(DIV_RelA, TagID =="965") #Subset by colony  
  Mcap_965.dist <- phyloseq::distance(Mcap_965, method = "bray")
  samp.Mcap_965<- as(sample_data(Mcap_965), "data.frame") #sample df
  
    #adonis by colony level
    adonis2(Mcap_965.dist ~ Location, data = samp.Mcap_965)

#969
Mcap_969 <- subset_samples(DIV_RelA, TagID =="969") #Subset by colony  
  Mcap_969.dist <- phyloseq::distance(Mcap_969, method = "bray")
  samp.Mcap_969<- as(sample_data(Mcap_969), "data.frame") #sample df
  
    #adonis by colony level
    adonis2(Mcap_969.dist ~ Location, data = samp.Mcap_969)
    
#972
Mcap_972 <- subset_samples(DIV_RelA, TagID =="972") #Subset by colony  
  Mcap_972.dist <- phyloseq::distance(Mcap_972, method = "bray")
  samp.Mcap_972<- as(sample_data(Mcap_972), "data.frame") #sample df
  
    #adonis by colony level
    adonis2(Mcap_972.dist ~ Location, data = samp.Mcap_972)
   
#971
Mcap_971 <- subset_samples(DIV_RelA, TagID =="971") #Subset by colony  
  Mcap_971.dist <- phyloseq::distance(Mcap_971, method = "bray")
  samp.Mcap_971<- as(sample_data(Mcap_971), "data.frame") #sample df
  
    #adonis by colony level
    adonis2(Mcap_971.dist ~ Location, data = samp.Mcap_971)    

#968
Mcap_968 <- subset_samples(DIV_RelA, TagID =="968") #Subset by colony  
  Mcap_968.dist <- phyloseq::distance(Mcap_968, method = "bray")
  samp.Mcap_968<- as(sample_data(Mcap_968), "data.frame") #sample df
  
    #adonis by colony level
    adonis2(Mcap_968.dist ~ Location, data = samp.Mcap_968)    
    
    
#966
Mcap_966 <- subset_samples(DIV_RelA, TagID =="966") #Subset by colony  
  Mcap_966.dist <- phyloseq::distance(Mcap_966, method = "bray")
  samp.Mcap_966<- as(sample_data(Mcap_966), "data.frame") #sample df
  
    #adonis by colony level
    adonis2(Mcap_966.dist ~ Location, data = samp.Mcap_966)
    
#978
Mcap_978 <- subset_samples(DIV_RelA, TagID =="978") #Subset by colony  
  Mcap_978.dist <- phyloseq::distance(Mcap_978, method = "bray")
  samp.Mcap_978<- as(sample_data(Mcap_978), "data.frame") #sample df
  
    #adonis by colony level
    adonis2(Mcap_978.dist ~ Location, data = samp.Mcap_978)
    
 #963
Mcap_963 <- subset_samples(DIV_RelA, TagID =="963") #Subset by colony  
  Mcap_963.dist <- phyloseq::distance(Mcap_963, method = "bray")
  samp.Mcap_963<- as(sample_data(Mcap_963), "data.frame") #sample df
  
    #adonis by colony level
    adonis2(Mcap_963.dist ~ Location, data = samp.Mcap_963)

#961
Mcap_961 <- subset_samples(DIV_RelA, TagID =="961") #Subset by colony  
  Mcap_961.dist <- phyloseq::distance(Mcap_961, method = "bray")
  samp.Mcap_961<- as(sample_data(Mcap_961), "data.frame") #sample df
  
    #adonis by colony level
    adonis2(Mcap_961.dist ~ Location, data = samp.Mcap_961)
    
#981
Mcap_981 <- subset_samples(DIV_RelA, TagID =="981") #Subset by colony  
  Mcap_981.dist <- phyloseq::distance(Mcap_981, method = "bray")
  samp.Mcap_981<- as(sample_data(Mcap_981), "data.frame") #sample df
  
    #adonis by colony level
    adonis2(Mcap_981.dist ~ Location, data = samp.Mcap_981)
    
#967
Mcap_967 <- subset_samples(DIV_RelA, TagID =="967") #Subset by colony  
  Mcap_967.dist <- phyloseq::distance(Mcap_967, method = "bray")
  samp.Mcap_967<- as(sample_data(Mcap_967), "data.frame") #sample df
  
    #adonis by colony level
    adonis2(Mcap_967.dist ~ Location, data = samp.Mcap_967)
    
#983
Mcap_983 <- subset_samples(DIV_RelA, TagID =="983") #Subset by colony  
  Mcap_983.dist <- phyloseq::distance(Mcap_983, method = "bray")
  samp.Mcap_983<- as(sample_data(Mcap_983), "data.frame") #sample df
  
    #adonis by colony level
    adonis2(Mcap_983.dist ~ Location, data = samp.Mcap_983)
    
#974
Mcap_974 <- subset_samples(DIV_RelA, TagID =="974") #Subset by colony  
  Mcap_974.dist <- phyloseq::distance(Mcap_974, method = "bray")
  samp.Mcap_974<- as(sample_data(Mcap_974), "data.frame") #sample df
  
    #adonis by colony level
    adonis2(Mcap_974.dist ~ Location, data = samp.Mcap_974)
    
#984
Mcap_984 <- subset_samples(DIV_RelA, TagID =="984") #Subset by colony  
  Mcap_984.dist <- phyloseq::distance(Mcap_984, method = "bray")
  samp.Mcap_984<- as(sample_data(Mcap_984), "data.frame") #sample df
  
    #adonis by colony level
    adonis2(Mcap_984.dist ~ Location, data = samp.Mcap_984)
    
#962
Mcap_962 <- subset_samples(DIV_RelA, TagID =="962") #Subset by colony  
  Mcap_962.dist <- phyloseq::distance(Mcap_962, method = "bray")
  samp.Mcap_962<- as(sample_data(Mcap_962), "data.frame") #sample df
  
    #adonis by colony level
    adonis2(Mcap_962.dist ~ Location, data = samp.Mcap_962)
    
#957
Mcap_957 <- subset_samples(DIV_RelA, TagID =="957") #Subset by colony  
  Mcap_957.dist <- phyloseq::distance(Mcap_957, method = "bray")
  samp.Mcap_957<- as(sample_data(Mcap_957), "data.frame") #sample df
  
    #adonis by colony level
    adonis2(Mcap_957.dist ~ Location, data = samp.Mcap_957)
    
#945
Mcap_945 <- subset_samples(DIV_RelA, TagID =="945") #Subset by colony  
  Mcap_945.dist <- phyloseq::distance(Mcap_945, method = "bray")
  samp.Mcap_945<- as(sample_data(Mcap_945), "data.frame") #sample df
  
    #adonis by colony level
    adonis2(Mcap_945.dist ~ Location, data = samp.Mcap_945)
        
#960
Mcap_960 <- subset_samples(DIV_RelA, TagID =="960") #Subset by colony  
  Mcap_960.dist <- phyloseq::distance(Mcap_960, method = "bray")
  samp.Mcap_960<- as(sample_data(Mcap_960), "data.frame") #sample df
  
    #adonis by colony level
    adonis2(Mcap_960.dist ~ Location, data = samp.Mcap_960)
    
#976
Mcap_976 <- subset_samples(DIV_RelA, TagID =="976") #Subset by colony  
  Mcap_976.dist <- phyloseq::distance(Mcap_976, method = "bray")
  samp.Mcap_976<- as(sample_data(Mcap_976), "data.frame") #sample df
  
    #adonis by colony level
    adonis2(Mcap_976.dist ~ Location, data = samp.Mcap_976)
    
#985
Mcap_985 <- subset_samples(DIV_RelA, TagID =="985") #Subset by colony  
  Mcap_985.dist <- phyloseq::distance(Mcap_985, method = "bray")
  samp.Mcap_985<- as(sample_data(Mcap_985), "data.frame") #sample df
  
    #adonis by colony level
    adonis2(Mcap_985.dist ~ Location, data = samp.Mcap_985)
    
#964
Mcap_964 <- subset_samples(DIV_RelA, TagID =="964") #Subset by colony  
  Mcap_964.dist <- phyloseq::distance(Mcap_964, method = "bray")
  samp.Mcap_964<- as(sample_data(Mcap_964), "data.frame") #sample df
  
    #adonis by colony level
    adonis2(Mcap_964.dist ~ Location, data = samp.Mcap_964)
    
#959
Mcap_959 <- subset_samples(DIV_RelA, TagID =="959") #Subset by colony  
  Mcap_959.dist <- phyloseq::distance(Mcap_959, method = "bray")
  samp.Mcap_959<- as(sample_data(Mcap_959), "data.frame") #sample df
  
    #adonis by colony level
    adonis2(Mcap_959.dist ~ Location, data = samp.Mcap_959)
    
#980
Mcap_980 <- subset_samples(DIV_RelA, TagID =="980") #Subset by colony  
  Mcap_980.dist <- phyloseq::distance(Mcap_980, method = "bray")
  samp.Mcap_980<- as(sample_data(Mcap_980), "data.frame") #sample df
  
    #adonis by colony level
    adonis2(Mcap_980.dist ~ Location, data = samp.Mcap_980)
  
```
Plots DIVS by colony
```{r}  

#try to transform samp counts

#for the legend
 plot_bar(Mcap_970,fill = "DIV")+
      geom_bar(aes(color=DIV, fill=DIV), stat="identity", position="stack")




Mcap_970_plot<-plot_bar(Mcap_970, "Sample_name", fill="DIV", title="Mcap_970")+
   theme(legend.position="none");Mcap_970_plot
Mcap_965_plot<-plot_bar(Mcap_965, "Sample_name", fill="DIV", title="Mcap_965")+
   theme(legend.position="none");Mcap_965_plot
Mcap_969_plot<-plot_bar(Mcap_969, "Sample_name", fill="DIV", title="Mcap_969")+
   theme(legend.position="none");Mcap_969_plot
Mcap_972_plot<-plot_bar(Mcap_972, "Sample_name", fill="DIV", title="Mcap_972")+
   theme(legend.position="none");Mcap_972_plot
Mcap_971_plot<-plot_bar(Mcap_971, "Sample_name", fill="DIV", title="Mcap_971")+
   theme(legend.position="none");Mcap_971_plot
Mcap_968_plot<-plot_bar(Mcap_968, "Sample_name", fill="DIV", title="Mcap_968")+
   theme(legend.position="none");Mcap_968_plot
Mcap_966_plot<-plot_bar(Mcap_966, "Sample_name", fill="DIV", title="Mcap_966")+
   theme(legend.position="none");Mcap_966_plot
Mcap_978_plot<-plot_bar(Mcap_978, "Sample_name", fill="DIV", title="Mcap_978")+
   theme(legend.position="none");Mcap_978_plot
Mcap_963_plot<-plot_bar(Mcap_963, "Sample_name", fill="DIV", title="Mcap_963")+
   theme(legend.position="none");Mcap_963_plot
Mcap_961_plot<-plot_bar(Mcap_961, "Sample_name", fill="DIV", title="Mcap_961")+
   theme(legend.position="none");Mcap_961_plot
Mcap_981_plot<-plot_bar(Mcap_981, "Sample_name", fill="DIV", title="Mcap_981")+
   theme(legend.position="none");Mcap_981_plot
Mcap_967_plot<-plot_bar(Mcap_967, "Sample_name", fill="DIV", title="Mcap_967")+
   theme(legend.position="none");Mcap_967_plot
Mcap_983_plot<-plot_bar(Mcap_983, "Sample_name", fill="DIV", title="Mcap_983")+
   theme(legend.position="none");Mcap_983_plot
Mcap_974_plot<-plot_bar(Mcap_974, "Sample_name", fill="DIV", title="Mcap_974")+
   theme(legend.position="none");Mcap_974_plot
Mcap_984_plot<-plot_bar(Mcap_984, "Sample_name", fill="DIV", title="Mcap_984")+
   theme(legend.position="none");Mcap_984_plot
Mcap_962_plot<-plot_bar(Mcap_962, "Sample_name", fill="DIV", title="Mcap_962")+
   theme(legend.position="none");Mcap_962_plot
Mcap_957_plot<-plot_bar(Mcap_957, "Sample_name", fill="DIV", title="Mcap_957")+
   theme(legend.position="none");Mcap_957_plot
Mcap_945_plot<-plot_bar(Mcap_945, "Sample_name", fill="DIV", title="Mcap_945")+
   theme(legend.position="none");Mcap_945_plot
Mcap_960_plot<-plot_bar(Mcap_960, "Sample_name", fill="DIV", title="Mcap_960")+
   theme(legend.position="none");Mcap_960_plot
Mcap_976_plot<-plot_bar(Mcap_976, "Sample_name", fill="DIV", title="Mcap_976")+
   theme(legend.position="none");Mcap_976_plot
Mcap_985_plot<-plot_bar(Mcap_985, "Sample_name", fill="DIV", title="Mcap_985")+
   theme(legend.position="none");Mcap_985_plot
Mcap_964_plot<-plot_bar(Mcap_964, "Sample_name", fill="DIV", title="Mcap_964")+
   theme(legend.position="none");Mcap_964_plot
Mcap_985_plot<-plot_bar(Mcap_985, "Sample_name", fill="DIV", title="Mcap_985")+
   theme(legend.position="none");Mcap_985_plot
Mcap_959_plot<-plot_bar(Mcap_959, "Sample_name", fill="DIV", title="Mcap_959")+
   theme(legend.position="none");Mcap_959_plot
Mcap_980_plot<-plot_bar(Mcap_980, "Sample_name", fill="DIV", title="Mcap_980")+
   theme(legend.position="none");Mcap_980_plot

#name of sample location on C/Ds
Mcap_970_plotB<-plot_bar(Mcap_970, "LocSamp", fill="DIV", title="Mcap_970")+
   theme(legend.position="none");Mcap_970_plotB


Mcap_DIV_plot1 <- ggarrange(Mcap_970_plot, Mcap_965_plot,Mcap_969_plot,Mcap_972_plot, Mcap_971_plot,Mcap_968_plot,Mcap_966_plot,Mcap_978_plot,
                    #labels = c("A", "B", "C","D","E","F"),
                    ncol = 4, nrow = 2);Mcap_DIV_plot1

Mcap_DIV_plot2 <- ggarrange(Mcap_963_plot, Mcap_961_plot,Mcap_981_plot,Mcap_967_plot,
Mcap_983_plot,Mcap_974_plot,Mcap_984_plot,Mcap_962_plot,
                    #labels = c("A", "B", "C","D","E","F"),
                    ncol = 4, nrow = 2);Mcap_DIV_plot2

Mcap_DIV_plot3 <- ggarrange(Mcap_957_plot,Mcap_945_plot,Mcap_960_plot,Mcap_976_plot,
Mcap_985_plot,Mcap_964_plot,Mcap_985_plot,Mcap_964_plot,Mcap_985_plot,Mcap_959_plot,Mcap_980_plot,
                    #labels = c("A", "B", "C","D","E","F"),
                    ncol = 4, nrow = 3);Mcap_DIV_plot3

```

#PROFILES
Subset by colony PROFILE, data setup
Pro_RelA is the rareified df
```{r}  
 
library("RColorBrewer")
getPalette = colorRampPalette(brewer.pal(8, "Dark2"))

speciesList = unique(tax_table(Pro_RelA)[,"its2_type_profile"])
speciesPalette = getPalette(length(speciesList))
names(speciesPalette) = speciesList

#scale_color_manual(values=speciesPalette)
#scale_fill_manual(values= speciesPalette)

#this works but you need better pallet color = grDevices::colors()[grep('gr(a|e)y', grDevices::colors(), invert = T)]

#reorder factor for plotting to make plots in order
sample_data(Pro_RelA)$Location <- factor(sample_data(Pro_RelA)$Location, levels = c("Branch tip", 
    "Branch mid", "Branch base", "Plate top","Plate edge","Plate underside","Lowest","Deepest"))
levels(sample_data(Pro_RelA)$Location)

sample_variables(Pro_RelA) #what are the variables

Mcap_970_Pro <- subset_samples(Pro_RelA, TagID =="970") #Subset by colony  
Mcap_965_Pro <- subset_samples(Pro_RelA, TagID =="965") #Subset by colony  
Mcap_969_Pro <- subset_samples(Pro_RelA, TagID =="969") #Subset by colony  
Mcap_972_Pro <- subset_samples(Pro_RelA, TagID =="972") #Subset by colony  
Mcap_971_Pro <- subset_samples(Pro_RelA, TagID =="971") #Subset by colony 
Mcap_968_Pro <- subset_samples(Pro_RelA, TagID =="968") #Subset by colony 
Mcap_966_Pro <- subset_samples(Pro_RelA, TagID =="966") #Subset by colony 
Mcap_978_Pro <- subset_samples(Pro_RelA, TagID =="978") #Subset by colony 
Mcap_963_Pro <- subset_samples(Pro_RelA, TagID =="963") #Subset by colony 
Mcap_961_Pro <- subset_samples(Pro_RelA, TagID =="961") #Subset by colony 
Mcap_981_Pro <- subset_samples(Pro_RelA, TagID =="981") #Subset by colony 
Mcap_967_Pro <- subset_samples(Pro_RelA, TagID =="967") #Subset by colony 
Mcap_983_Pro <- subset_samples(Pro_RelA, TagID =="983") #Subset by colony 
Mcap_974_Pro <- subset_samples(Pro_RelA, TagID =="974") #Subset by colony 
Mcap_984_Pro <- subset_samples(Pro_RelA, TagID =="984") #Subset by colony 
Mcap_962_Pro <- subset_samples(Pro_RelA, TagID =="962") #Subset by colony 
Mcap_957_Pro <- subset_samples(Pro_RelA, TagID =="957") #Subset by colony 
Mcap_945_Pro <- subset_samples(Pro_RelA, TagID =="945") #Subset by colony 
Mcap_960_Pro <- subset_samples(Pro_RelA, TagID =="960") #Subset by colony 
Mcap_976_Pro <- subset_samples(Pro_RelA, TagID =="976") #Subset by colony 
Mcap_985_Pro <- subset_samples(Pro_RelA, TagID =="985") #Subset by colony 
Mcap_964_Pro <- subset_samples(Pro_RelA, TagID =="964") #Subset by colony 
Mcap_959_Pro <- subset_samples(Pro_RelA, TagID =="959") #Subset by colony 
Mcap_980_Pro <- subset_samples(Pro_RelA, TagID =="980") #Subset by colony 
  
```
Plots PRO - colored by orange and blue
```{r} 
library(RColorBrewer)
profile.colors <- c("C31/C17d-C21-C21ac-C31a-C17e-C31.9-C17f" = "#0b17ff", 
                    "C31-C17d-C31.1-C31a-C21-C17e-C21ac" = "#3e38f6",
                    "C31-C17d-C21-C31.9-C21ac-C17e-C31h-C31a" ="#5350ed",
                    "C17d/C31-C21-C21ac-C17e-C17f-C31.9" = "#6065e3",
                    "C31/C17d-C21-C31.9-C31h-C31i-C21ac" = "#6879d9",
                    "C31/C17d" = "#6c8dd0",
                    "C31/C17d-C21-C21ac" = "#6da0c5",
                    "C31/C17d-C21-C21ac-C31.9" = "#6bb3bb",
                   "C1/C3" = "#64c6af",
                   "C21/C3" = "#58d9a3",
                   "C21" = "#44ec96",
                   "C3" = "#09ff88",
                   "D1/D4-D6-D1ab-D3h-D4d" = "#ff9422",
                   "D4/D1/D6-D1ab-D3h" = "#ffaa20",
                   "D1/D4/D6/D1ab" = "#ffc01e",
                   "D4/D1-D6-D1ab-D17d-D17j-D3h" ="#ffd51a",
                   "D1/D4" = "#feea15",
                   "D1/D4/D6" = "#fbff0e")




#for the legend
  Mcap_970_PRO_plot<-plot_bar(Mcap_970_Pro, "LocSamp",fill="its2_type_profile", title="Mcap_970_Pro")+
  scale_fill_manual(values=profile.colors)+
  theme(axis.text.x = element_text(angle = 90))+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"));Mcap_970_PRO_plot

 
 
 Mcap_970_PRO_plot<-plot_bar(Mcap_970_Pro, "LocSamp",fill="its2_type_profile", title="Mcap_970_Pro")+
  scale_fill_manual(values=profile.colors)+
   theme(legend.position="none") + 
  theme(axis.text.x = element_text(angle = 90))+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"));Mcap_970_PRO_plot
ggsave("Mcap_970_PRO_plot.pdf")


Mcap_970_PRO_plot<-plot_bar(Mcap_970_Pro, "LocSamp", fill="its2_type_profile", title="Mcap_970_Pro")+
    scale_fill_manual(values=profile.colors)+
   theme_bw()+
   theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
   theme(legend.position="none");Mcap_970_PRO_plot
ggsave("Mcap_970_PRO_plot.pdf")


Mcap_965_PRO_plot<-plot_bar(Mcap_965_Pro, "LocSamp", fill="its2_type_profile", title="Mcap_965_Pro")+
    scale_fill_manual(values=profile.colors)+
  theme_bw()+
   theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
   theme(legend.position="none");Mcap_965_PRO_plot
ggsave("Mcap_965_PRO_plot.pdf")

Mcap_969_PRO_plot<-plot_bar(Mcap_969_Pro, "LocSamp", fill="its2_type_profile", title="Mcap_969_Pro")+
    scale_fill_manual(values=profile.colors)+
  theme_bw()+
   theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
   theme(legend.position="none");Mcap_969_PRO_plot
ggsave("Mcap_969_PRO_plot.pdf")

Mcap_972_PRO_plot<-plot_bar(Mcap_972_Pro, "LocSamp", fill="its2_type_profile", title="Mcap_972_Pro")+
    scale_fill_manual(values=profile.colors)+
  theme_bw()+
   theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
   theme(legend.position="none");Mcap_972_PRO_plot
ggsave("Mcap_972_PRO_plot.pdf")

Mcap_971_PRO_plot<-plot_bar(Mcap_971_Pro, "LocSamp", fill="its2_type_profile", title="Mcap_971_Pro")+
    scale_fill_manual(values=profile.colors)+
  theme_bw()+
   theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
   theme(legend.position="none");Mcap_971_PRO_plot
ggsave("Mcap_971_PRO_plot.pdf")

Mcap_968_PRO_plot<-plot_bar(Mcap_968_Pro, "LocSamp", fill="its2_type_profile", title="Mcap_968_Pro")+
    scale_fill_manual(values=profile.colors)+
  theme_bw()+
   theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
   theme(legend.position="none");Mcap_968_PRO_plot
ggsave("Mcap_968_PRO_plot.pdf")

Mcap_966_PRO_plot<-plot_bar(Mcap_966_Pro, "LocSamp", fill="its2_type_profile", title="Mcap_966_Pro")+
    scale_fill_manual(values=profile.colors)+
  theme_bw()+
   theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
   theme(legend.position="none");Mcap_966_PRO_plot
ggsave("Mcap_966_PRO_plot.pdf")

Mcap_978_PRO_plot<-plot_bar(Mcap_978_Pro, "LocSamp", fill="its2_type_profile", title="Mcap_978_Pro")+
    scale_fill_manual(values=profile.colors)+
  theme_bw()+
   theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
   theme(legend.position="none");Mcap_978_PRO_plot
ggsave("Mcap_978_PRO_plot.pdf")

Mcap_963_PRO_plot<-plot_bar(Mcap_963_Pro, "LocSamp", fill="its2_type_profile", title="Mcap_963_Pro")+
    scale_fill_manual(values=profile.colors)+
  theme_bw()+
   theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
   theme(legend.position="none");Mcap_963_PRO_plot
ggsave("Mcap_963_PRO_plot.pdf")

Mcap_961_PRO_plot<-plot_bar(Mcap_961_Pro, "LocSamp", fill="its2_type_profile", title="Mcap_961_Pro")+
    scale_fill_manual(values=profile.colors)+
  theme_bw()+
   theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
   theme(legend.position="none");Mcap_961_PRO_plot
ggsave("Mcap_961_PRO_plot.pdf")

Mcap_981_PRO_plot<-plot_bar(Mcap_981_Pro, "LocSamp", fill="its2_type_profile", title="Mcap_981_Pro")+
    scale_fill_manual(values=profile.colors)+
  theme_bw()+
   theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
   theme(legend.position="none");Mcap_981_PRO_plot
ggsave("Mcap_981_PRO_plot.pdf")

Mcap_967_PRO_plot<-plot_bar(Mcap_967_Pro, "LocSamp", fill="its2_type_profile", title="Mcap_967_Pro")+
    scale_fill_manual(values=profile.colors)+
  theme_bw()+
   theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
   theme(legend.position="none");Mcap_967_PRO_plot
ggsave("Mcap_967_PRO_plot.pdf")

Mcap_983_PRO_plot<-plot_bar(Mcap_983_Pro, "LocSamp", fill="its2_type_profile", title="Mcap_983_Pro")+
    scale_fill_manual(values=profile.colors)+
  theme_bw()+
   theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
   theme(legend.position="none");Mcap_983_PRO_plot
ggsave("Mcap_983_PRO_plot.pdf")

Mcap_974_PRO_plot<-plot_bar(Mcap_974_Pro, "LocSamp", fill="its2_type_profile", title="Mcap_974_Pro")+
    scale_fill_manual(values=profile.colors)+
  theme_bw()+
   theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
   theme(legend.position="none");Mcap_974_PRO_plot
ggsave("Mcap_974_PRO_plot.pdf")

Mcap_984_PRO_plot<-plot_bar(Mcap_984_Pro, "LocSamp", fill="its2_type_profile", title="Mcap_984_Pro")+
    scale_fill_manual(values=profile.colors)+
  theme_bw()+
   theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
   theme(legend.position="none");Mcap_984_PRO_plot
ggsave("Mcap_984_PRO_plot.pdf")

Mcap_962_PRO_plot<-plot_bar(Mcap_962_Pro, "LocSamp", fill="its2_type_profile", title="Mcap_962_Pro")+
    scale_fill_manual(values=profile.colors)+
  theme_bw()+
   theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
   theme(legend.position="none");Mcap_962_PRO_plot
ggsave("Mcap_962_PRO_plot.pdf")

Mcap_957_PRO_plot<-plot_bar(Mcap_957_Pro, "LocSamp", fill="its2_type_profile", title="Mcap_957_Pro")+
    scale_fill_manual(values=profile.colors)+
  theme_bw()+
   theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
   theme(legend.position="none");Mcap_957_PRO_plot
ggsave("Mcap_957_PRO_plot.pdf")

Mcap_945_PRO_plot<-plot_bar(Mcap_945_Pro, "LocSamp", fill="its2_type_profile", title="Mcap_945_Pro")+
    scale_fill_manual(values=profile.colors)+
  theme_bw()+
   theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
   theme(legend.position="none");Mcap_945_PRO_plot
ggsave("Mcap_945_PRO_plot.pdf")

Mcap_960_PRO_plot<-plot_bar(Mcap_960_Pro, "LocSamp", fill="its2_type_profile", title="Mcap_960_Pro")+
    scale_fill_manual(values=profile.colors)+
  theme_bw()+
   theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
   theme(legend.position="none");Mcap_960_PRO_plot
ggsave("Mcap_960_PRO_plot.pdf")

Mcap_976_PRO_plot<-plot_bar(Mcap_976_Pro, "LocSamp", fill="its2_type_profile", title="Mcap_976_Pro")+
    scale_fill_manual(values=profile.colors)+
  theme_bw()+
   theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
   theme(legend.position="none");Mcap_976_PRO_plot
ggsave("Mcap_976_PRO_plot.pdf")

Mcap_985_PRO_plot<-plot_bar(Mcap_985_Pro, "LocSamp", fill="its2_type_profile", title="Mcap_985_Pro")+
    scale_fill_manual(values=profile.colors)+
  theme_bw()+
   theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
   theme(legend.position="none");Mcap_985_PRO_plot
ggsave("Mcap_985_PRO_plot.pdf")

Mcap_964_PRO_plot<-plot_bar(Mcap_964_Pro, "LocSamp", fill="its2_type_profile", title="Mcap_964_Pro")+
    scale_fill_manual(values=profile.colors)+
  theme_bw()+
   theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
   theme(legend.position="none");Mcap_964_PRO_plot
ggsave("Mcap_964_PRO_plot.pdf")

Mcap_985_PRO_plot<-plot_bar(Mcap_985_Pro, "LocSamp", fill="its2_type_profile", title="Mcap_985_Pro")+
    scale_fill_manual(values=profile.colors)+
  theme_bw()+
   theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
   theme(legend.position="none");Mcap_985_PRO_plot
ggsave("Mcap_985_PRO_plot.pdf")

Mcap_959_PRO_plot<-plot_bar(Mcap_959_Pro, "LocSamp", fill="its2_type_profile", title="Mcap_959_Pro")+
    scale_fill_manual(values=profile.colors)+
  theme_bw()+
   theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
   theme(legend.position="none");Mcap_959_PRO_plot
ggsave("Mcap_959_PRO_plot.pdf")

Mcap_980_PRO_plot<-plot_bar(Mcap_980_Pro, "LocSamp", fill="its2_type_profile", title="Mcap_980_Pro")+
    scale_fill_manual(values=profile.colors)+
  theme_bw()+
   theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
   theme(legend.position="none");Mcap_980_PRO_plot
ggsave("Mcap_980_PRO_plot.pdf")


# 
# Mcap_DIV_PRO_plot1 <- ggarrange(Mcap_970_PRO_plot, Mcap_965_PRO_plot,Mcap_969_PRO_plot,Mcap_972_PRO_plot, Mcap_971_PRO_plot,Mcap_968_PRO_plot,Mcap_966_PRO_plot,Mcap_978_PRO_plot,
#                     #labels = c("A", "B", "C","D","E","F"),
#                     ncol = 4, nrow = 2);Mcap_DIV_PRO_plot1
# 
# Mcap_DIV_PRO_plot2 <- ggarrange(Mcap_963_PRO_plot, Mcap_961_PRO_plot,Mcap_981_PRO_plot,Mcap_967_PRO_plot,
# Mcap_983_PRO_plot,Mcap_974_PRO_plot,Mcap_984_PRO_plot,Mcap_962_PRO_plot,
#                     #labels = c("A", "B", "C","D","E","F"),
#                     ncol = 4, nrow = 2);Mcap_DIV_PRO_plot2
# 
# Mcap_DIV_PRO_plot3 <- ggarrange(Mcap_957_PRO_plot,Mcap_945_PRO_plot,Mcap_960_PRO_plot,Mcap_976_PRO_plot,
# Mcap_985_PRO_plot,Mcap_964_PRO_plot,Mcap_985_PRO_plot,Mcap_964_PRO_plot,Mcap_985_PRO_plot,Mcap_959_PRO_plot,Mcap_980_PRO_plot,
#                     #labels = c("A", "B", "C","D","E","F"),
#                     ncol = 4, nrow = 3);Mcap_DIV_PRO_plot3
# 
# 
# Mcap_DIV_PRO_plot1 <- ggarrange(Mcap_970_PRO_plot, Mcap_965_PRO_plot,Mcap_969_PRO_plot,Mcap_972_PRO_plot, 
#                     ncol = 4, nrow = 2);Mcap_DIV_PRO_plot1

```
Plots PRO - colored by diverging colors for C-dom and D-dom

```{r} 
library(RColorBrewer)
profile.colors <- c("C31/C17d-C21-C21ac-C31a-C17e-C31.9-C17f" = "#0b17ff", 
                    "C31-C17d-C31.1-C31a-C21-C17e-C21ac" = "orchid4",
                    "C31-C17d-C21-C31.9-C21ac-C17e-C31h-C31a" ="gold4",
                    "C17d/C31-C21-C21ac-C17e-C17f-C31.9" = "tomato1",
                    "C31/C17d-C21-C31.9-C31h-C31i-C21ac" = "magenta",
                    "C31/C17d" = "#6c8dd0",
                    "C31/C17d-C21-C21ac" = "aquamarine",
                    "C31/C17d-C21-C21ac-C31.9" = "cyan",
                   "C1/C3" = "yellowgreen",
                   "C21/C3" = "sienna",
                   "C21" = "purple4",
                   "C3" = "forestgreen",
                   "D1/D4-D6-D1ab-D3h-D4d" = "#ff9422",
                   "D4/D1/D6-D1ab-D3h" = "yellow",
                   "D1/D4/D6/D1ab" = "red4",
                   "D4/D1-D6-D1ab-D17d-D17j-D3h" ="#ffd51a",
                   "D1/D4" = "ivory4",
                   "D1/D4/D6" = "black")



#for the legend
  Mcap_970_PRO_plot<-plot_bar(Mcap_970_Pro, "LocSamp",fill="its2_type_profile", title="Mcap_970_Pro")+
  scale_fill_manual(values=profile.colors)+
  theme(axis.text.x = element_text(angle = 90))+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"));Mcap_970_PRO_plot

 #reorder factor for plotting to make plots in order
sample_data(Mcap_970_Pro)$LocSamp <- factor(sample_data(Mcap_970_Pro)$LocSamp, levels = c("Branch tip_A1", 
    "Branch tip_A12", "Branch tip_A4","Branch tip_A9", "Branch mid_A2","Branch mid_A5","Branch mid_A13" ,"Branch mid_A10", "Branch base_A3", "Branch base_A6","Branch base_A11" ,"Branch base_A14","Lowest_A8","Lowest_A16","Deepest_A7", "Deepest_A15"))
levels(sample_data(Mcap_970_Pro)$LocSamp)
 
 Mcap_970_PRO_plot<-plot_bar(Mcap_970_Pro, "LocSamp",fill="its2_type_profile", title="Mcap_970_Pro")+
  scale_fill_manual(values=profile.colors)+
   theme(legend.position="none") + 
  theme(axis.text.x = element_text(angle = 90))+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"));Mcap_970_PRO_plot
ggsave("Mcap_970_PRO_plot.pdf")


Mcap_970_PRO_plot<-plot_bar(Mcap_970_Pro, "LocSamp", fill="its2_type_profile", title="Mcap_970_Pro")+
    scale_fill_manual(values=profile.colors)+
   theme_bw()+
   theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
   theme(legend.position="none");Mcap_970_PRO_plot
ggsave("Mcap_970_PRO_plot.pdf")

#965
 #reorder factor for plotting to make plots in order
sample_data(Mcap_965_Pro)$LocSamp <- factor(sample_data(Mcap_965_Pro)$LocSamp, levels = c("Branch tip_B1", 
    "Branch tip_B4", "Branch tip_B9","Branch tip_B12", "Branch mid_B2","Branch mid_B5","Branch mid_B10" , "Branch base_B3", "Branch base_B11","Branch base_B14" ,"Lowest_B8","Lowest_B16","Deepest_B7", "Deepest_B15"))
levels(sample_data(Mcap_965_Pro)$LocSamp)

Mcap_965_PRO_plot<-plot_bar(Mcap_965_Pro, "LocSamp", fill="its2_type_profile", title="Mcap_965_Pro")+
    scale_fill_manual(values=profile.colors)+
  theme_bw()+
   theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
   theme(legend.position="none");Mcap_965_PRO_plot
ggsave("Mcap_965_PRO_plot.pdf")

#969
 #reorder factor for plotting to make plots in order
sample_data(Mcap_969_Pro)$LocSamp <- factor(sample_data(Mcap_969_Pro)$LocSamp, levels = c("Branch tip_C1", 
    "Branch tip_C4", "Branch tip_C9","Branch tip_C12", "Branch mid_C2","Branch mid_C5","Branch mid_C10" , "Branch mid_C13" ,"Branch base_C3","Branch base_C6","Branch base_C13", "Branch base_C11","Lowest_C8","Lowest_C16","Deepest_C7", "Deepest_C15"))
levels(sample_data(Mcap_969_Pro)$LocSamp)

Mcap_969_PRO_plot<-plot_bar(Mcap_969_Pro, "LocSamp", fill="its2_type_profile", title="Mcap_969_Pro")+
    scale_fill_manual(values=profile.colors)+
  theme_bw()+
   theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
   theme(legend.position="none");Mcap_969_PRO_plot
ggsave("Mcap_969_PRO_plot.pdf")

#972
 #reorder factor for plotting to make plots in order
sample_data(Mcap_972_Pro)$LocSamp <- factor(sample_data(Mcap_972_Pro)$LocSamp, levels = c("Branch tip_D1", 
    "Branch tip_D9",  "Branch mid_D2","Branch mid_D10","Branch base_D3","Branch base_D11", "Plate top_D4","Plate top_D12","Plate edge_D5", "Plate edge_D13","Plate underside_D6", "Plate underside_D14","Lowest_D8","Lowest_D16","Deepest_D7", "Deepest_D15"))
levels(sample_data(Mcap_972_Pro)$LocSamp)

Mcap_972_PRO_plot<-plot_bar(Mcap_972_Pro, "LocSamp", fill="its2_type_profile", title="Mcap_972_Pro")+
    scale_fill_manual(values=profile.colors)+
  theme_bw()+
   theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
   theme(legend.position="none");Mcap_972_PRO_plot
ggsave("Mcap_972_PRO_plot.pdf")

#971
 #reorder factor for plotting to make plots in order
sample_data(Mcap_971_Pro)$LocSamp <- factor(sample_data(Mcap_971_Pro)$LocSamp, levels = c("Branch tip_E1", 
    "Branch tip_E4", "Branch tip_E9","Branch tip_E12", "Branch mid_E2","Branch mid_E5","Branch mid_E10" , "Branch mid_E13" ,"Branch base_E3","Branch base_E6","Branch base_E11", "Branch base_E14","Lowest_E8","Lowest_E16","Deepest_E7", "Deepest_E15"))
levels(sample_data(Mcap_971_Pro)$LocSamp)

Mcap_971_PRO_plot<-plot_bar(Mcap_971_Pro, "LocSamp", fill="its2_type_profile", title="Mcap_971_Pro")+
    scale_fill_manual(values=profile.colors)+
  theme_bw()+
   theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
   theme(legend.position="none");Mcap_971_PRO_plot
ggsave("Mcap_971_PRO_plot.pdf")


#968
 #reorder factor for plotting to make plots in order
sample_data(Mcap_968_Pro)$LocSamp <- factor(sample_data(Mcap_968_Pro)$LocSamp, levels = c("Branch tip_F1", 
    "Branch tip_F4", "Branch tip_F9","Branch tip_F12", "Branch mid_F2","Branch mid_F5","Branch mid_F10" , "Branch mid_F13" ,"Branch base_F3","Branch base_F6","Branch base_F11", "Branch base_F14","Lowest_F8","Lowest_F16","Deepest_F7", "Deepest_F15"))
levels(sample_data(Mcap_968_Pro)$LocSamp)

Mcap_968_PRO_plot<-plot_bar(Mcap_968_Pro, "LocSamp", fill="its2_type_profile", title="Mcap_968_Pro")+
    scale_fill_manual(values=profile.colors)+
  theme_bw()+
   theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
   theme(legend.position="none");Mcap_968_PRO_plot
ggsave("Mcap_968_PRO_plot.pdf")


#966
 #reorder factor for plotting to make plots in order
sample_data(Mcap_966_Pro)$LocSamp <- factor(sample_data(Mcap_966_Pro)$LocSamp, levels = c(
    "Branch tip_G9",  "Branch mid_G2","Branch mid_G10","Branch base_G3","Branch base_G11", "Plate top_G4","Plate top_G12", "Plate edge_G13","Plate underside_G6", "Plate underside_G14","Lowest_G16","Deepest_G15"))
levels(sample_data(Mcap_966_Pro)$LocSamp)

Mcap_966_PRO_plot<-plot_bar(Mcap_966_Pro, "LocSamp", fill="its2_type_profile", title="Mcap_966_Pro")+
    scale_fill_manual(values=profile.colors)+
  theme_bw()+
   theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
   theme(legend.position="none");Mcap_966_PRO_plot
ggsave("Mcap_966_PRO_plot.pdf")


#978
 #reorder factor for plotting to make plots in order
sample_data(Mcap_978_Pro)$LocSamp <- factor(sample_data(Mcap_978_Pro)$LocSamp, levels = c("Branch tip_H1", 
    "Branch tip_H4", "Branch tip_H9","Branch tip_H12", "Branch mid_H2","Branch mid_H5","Branch mid_H10" , "Branch mid_H13" ,"Branch base_H3","Branch base_H6","Branch base_H11", "Branch base_H14","Lowest_H8","Lowest_H16","Deepest_H7", "Deepest_H15"))

Mcap_978_PRO_plot<-plot_bar(Mcap_978_Pro, "LocSamp", fill="its2_type_profile", title="Mcap_978_Pro")+
    scale_fill_manual(values=profile.colors)+
  theme_bw()+
   theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
   theme(legend.position="none");Mcap_978_PRO_plot
ggsave("Mcap_978_PRO_plot.pdf")

#963
 #reorder factor for plotting to make plots in order
sample_data(Mcap_963_Pro)$LocSamp <- factor(sample_data(Mcap_963_Pro)$LocSamp, levels = c("Branch tip_I1", 
    "Branch tip_I4", "Branch tip_I9","Branch tip_I12", "Branch mid_I2","Branch mid_I5","Branch mid_I10" , "Branch mid_I13" ,"Branch base_I3","Branch base_I6","Branch base_I11", "Branch base_I14","Lowest_I8","Lowest_I16","Deepest_I7", "Deepest_I15"))
Mcap_963_PRO_plot<-plot_bar(Mcap_963_Pro, "LocSamp", fill="its2_type_profile", title="Mcap_963_Pro")+
    scale_fill_manual(values=profile.colors)+
  theme_bw()+
   theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
   theme(legend.position="none");Mcap_963_PRO_plot
ggsave("Mcap_963_PRO_plot.pdf")


#961
 #reorder factor for plotting to make plots in order
sample_data(Mcap_961_Pro)$LocSamp <- factor(sample_data(Mcap_961_Pro)$LocSamp, levels = c("Branch tip_J1"
,    "Branch tip_J9",  "Branch mid_J2","Branch mid_J10","Branch base_J3","Branch base_J11", "Plate top_J4","Plate top_J12", "Plate edge_J5","Plate edge_J13","Plate underside_J6", "Plate underside_J14","Lowest_J8","Lowest_J16","Deepest_J7","Deepest_J15"))
levels(sample_data(Mcap_961_Pro)$LocSamp)

Mcap_961_PRO_plot<-plot_bar(Mcap_961_Pro, "LocSamp", fill="its2_type_profile", title="Mcap_961_Pro")+
    scale_fill_manual(values=profile.colors)+
  theme_bw()+
   theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
   theme(legend.position="none");Mcap_961_PRO_plot
ggsave("Mcap_961_PRO_plot.pdf")

#981
 #reorder factor for plotting to make plots in order
sample_data(Mcap_981_Pro)$LocSamp <- factor(sample_data(Mcap_981_Pro)$LocSamp, levels = c("Branch tip_K1", 
    "Branch tip_K4", "Branch tip_K9","Branch tip_K12", "Branch mid_K2","Branch mid_K5","Branch mid_K10" , "Branch mid_K13" ,"Branch base_K3","Branch base_K6","Branch base_K11", "Branch base_K14","Lowest_K8","Lowest_K16","Deepest_K7", "Deepest_K15"))
Mcap_981_PRO_plot<-plot_bar(Mcap_981_Pro, "LocSamp", fill="its2_type_profile", title="Mcap_981_Pro")+
    scale_fill_manual(values=profile.colors)+
  theme_bw()+
   theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
   theme(legend.position="none");Mcap_981_PRO_plot
ggsave("Mcap_981_PRO_plot.pdf")


#967
 #reorder factor for plotting to make plots in order
sample_data(Mcap_967_Pro)$LocSamp <- factor(sample_data(Mcap_967_Pro)$LocSamp, levels = c("Branch tip_L1", 
    "Branch tip_L4", "Branch tip_L9","Branch tip_L12", "Branch mid_L2","Branch mid_L5","Branch mid_L10" , "Branch mid_L13" ,"Branch base_L3","Branch base_L6","Branch base_L11", "Branch base_L14","Lowest_L8","Lowest_L16","Deepest_L7", "Deepest_L15"))

Mcap_967_PRO_plot<-plot_bar(Mcap_967_Pro, "LocSamp", fill="its2_type_profile", title="Mcap_967_Pro")+
    scale_fill_manual(values=profile.colors)+
  theme_bw()+
   theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
   theme(legend.position="none");Mcap_967_PRO_plot
ggsave("Mcap_967_PRO_plot.pdf")

#983
 #reorder factor for plotting to make plots in order
sample_data(Mcap_983_Pro)$LocSamp <- factor(sample_data(Mcap_983_Pro)$LocSamp, levels = c("Branch tip_M1", 
    "Branch tip_M4", "Branch tip_M9","Branch tip_M12", "Branch mid_M2","Branch mid_M5","Branch mid_M10" , "Branch mid_M13" ,"Branch base_M3","Branch base_M6","Branch base_M11", "Branch base_M14","Lowest_M8","Lowest_M16","Deepest_M7", "Deepest_M15"))

Mcap_983_PRO_plot<-plot_bar(Mcap_983_Pro, "LocSamp", fill="its2_type_profile", title="Mcap_983_Pro")+
    scale_fill_manual(values=profile.colors)+
  theme_bw()+
   theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
   theme(legend.position="none");Mcap_983_PRO_plot
ggsave("Mcap_983_PRO_plot.pdf")

#974
 #reorder factor for plotting to make plots in order
sample_data(Mcap_974_Pro)$LocSamp <- factor(sample_data(Mcap_974_Pro)$LocSamp, levels = c("Branch tip_N1"
,    "Branch tip_N9",  "Branch mid_N2","Branch mid_N10","Branch base_N3","Branch base_N11", "Plate top_N4","Plate top_N12", "Plate edge_N5","Plate edge_N13","Plate underside_N6", "Plate underside_N14","Lowest_N8","Lowest_N16","Deepest_N7","Deepest_N15"))

Mcap_974_PRO_plot<-plot_bar(Mcap_974_Pro, "LocSamp", fill="its2_type_profile", title="Mcap_974_Pro")+
    scale_fill_manual(values=profile.colors)+
  theme_bw()+
   theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
   theme(legend.position="none");Mcap_974_PRO_plot
ggsave("Mcap_974_PRO_plot.pdf")

#984
 #reorder factor for plotting to make plots in order
sample_data(Mcap_984_Pro)$LocSamp <- factor(sample_data(Mcap_984_Pro)$LocSamp, levels = c("Branch tip_O1", 
    "Branch tip_O4", "Branch tip_O9","Branch tip_O12", "Branch mid_O2","Branch mid_O5","Branch mid_O10" , "Branch mid_O13" ,"Branch base_O3","Branch base_O6","Branch base_O11", "Branch base_O14","Lowest_O8","Lowest_O16","Deepest_O7", "Deepest_O15"))

Mcap_984_PRO_plot<-plot_bar(Mcap_984_Pro, "LocSamp", fill="its2_type_profile", title="Mcap_984_Pro")+
    scale_fill_manual(values=profile.colors)+
  theme_bw()+
   theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
   theme(legend.position="none");Mcap_984_PRO_plot
ggsave("Mcap_984_PRO_plot.pdf")


Mcap_962_PRO_plot<-plot_bar(Mcap_962_Pro, "LocSamp", fill="its2_type_profile", title="Mcap_962_Pro")+
    scale_fill_manual(values=profile.colors)+
  theme_bw()+
   theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
   theme(legend.position="none");Mcap_962_PRO_plot
ggsave("Mcap_962_PRO_plot.pdf")


#957
 #reorder factor for plotting to make plots in order
sample_data(Mcap_957_Pro)$LocSamp <- factor(sample_data(Mcap_957_Pro)$LocSamp, levels = c("Branch tip_Q1", 
    "Branch tip_Q4", "Branch tip_Q9","Branch tip_Q12", "Branch mid_Q2","Branch mid_Q5","Branch mid_Q10" , "Branch mid_Q13" ,"Branch base_Q3","Branch base_Q6","Branch base_Q11", "Branch base_Q14","Lowest_Q8","Lowest_Q16","Deepest_Q7", "Deepest_Q15"))

Mcap_957_PRO_plot<-plot_bar(Mcap_957_Pro, "LocSamp", fill="its2_type_profile", title="Mcap_957_Pro")+
    scale_fill_manual(values=profile.colors)+
  theme_bw()+
   theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
   theme(legend.position="none");Mcap_957_PRO_plot
ggsave("Mcap_957_PRO_plot.pdf")

#945
 #reorder factor for plotting to make plots in order
sample_data(Mcap_945_Pro)$LocSamp <- factor(sample_data(Mcap_945_Pro)$LocSamp, levels = c("Branch tip_R1", 
    "Branch tip_R4", "Branch tip_R9","Branch tip_R12", "Branch mid_R2","Branch mid_R5","Branch mid_R10" , "Branch mid_R13" ,"Branch base_R3","Branch base_R6","Branch base_R11", "Branch base_R14","Lowest_R8","Lowest_R16","Deepest_R7", "Deepest_R15"))
Mcap_945_PRO_plot<-plot_bar(Mcap_945_Pro, "LocSamp", fill="its2_type_profile", title="Mcap_945_Pro")+
    scale_fill_manual(values=profile.colors)+
  theme_bw()+
   theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
   theme(legend.position="none");Mcap_945_PRO_plot
ggsave("Mcap_945_PRO_plot.pdf")


#960
 #reorder factor for plotting to make plots in order
sample_data(Mcap_960_Pro)$LocSamp <- factor(sample_data(Mcap_960_Pro)$LocSamp, levels = c("Branch tip_S1", 
    "Branch tip_S4", "Branch tip_S9","Branch tip_S12", "Branch mid_S2","Branch mid_S5","Branch mid_S10" , "Branch mid_S13" ,"Branch base_S3","Branch base_S6","Branch base_S11", "Branch base_S14","Lowest_S8","Lowest_S16","Deepest_S7", "Deepest_S15"))
Mcap_960_PRO_plot<-plot_bar(Mcap_960_Pro, "LocSamp", fill="its2_type_profile", title="Mcap_960_Pro")+
    scale_fill_manual(values=profile.colors)+
  theme_bw()+
   theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
   theme(legend.position="none");Mcap_960_PRO_plot
ggsave("Mcap_960_PRO_plot.pdf")

#976
 #reorder factor for plotting to make plots in order
sample_data(Mcap_976_Pro)$LocSamp <- factor(sample_data(Mcap_976_Pro)$LocSamp, levels = c("Branch tip_T1", 
    "Branch tip_T4", "Branch tip_T9","Branch tip_T12", "Branch mid_T2","Branch mid_T5","Branch mid_T10" , "Branch mid_T13" ,"Branch base_T3","Branch base_T6","Branch base_T11", "Branch base_T14","Lowest_T8","Lowest_T16","Deepest_T7", "Deepest_T15"))
Mcap_976_PRO_plot<-plot_bar(Mcap_976_Pro, "LocSamp", fill="its2_type_profile", title="Mcap_976_Pro")+
    scale_fill_manual(values=profile.colors)+
  theme_bw()+
   theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
   theme(legend.position="none");Mcap_976_PRO_plot
ggsave("Mcap_976_PRO_plot.pdf")

#CD
Mcap_985_PRO_plot<-plot_bar(Mcap_985_Pro, "LocSamp", fill="its2_type_profile", title="Mcap_985_Pro")+
    scale_fill_manual(values=profile.colors)+
  theme_bw()+
   theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
   theme(legend.position="none");Mcap_985_PRO_plot
ggsave("Mcap_985_PRO_plot.pdf")

Mcap_964_PRO_plot<-plot_bar(Mcap_964_Pro, "LocSamp", fill="its2_type_profile", title="Mcap_964_Pro")+
    scale_fill_manual(values=profile.colors)+
  theme_bw()+
   theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
   theme(legend.position="none");Mcap_964_PRO_plot
ggsave("Mcap_964_PRO_plot.pdf")


#985
 #reorder factor for plotting to make plots in order
sample_data(Mcap_985_Pro)$LocSamp <- factor(sample_data(Mcap_985_Pro)$LocSamp, levels = c("Branch tip_U1"
,    "Branch tip_U9",  "Branch mid_U2","Branch mid_U10","Branch base_U3","Branch base_U11", "Plate top_U4","Plate top_U12", "Plate edge_U5","Plate edge_U13","Plate underside_U6", "Plate underside_U14","Lowest_U8","Lowest_U16","Deepest_U7","Deepest_U15"))
Mcap_985_PRO_plot<-plot_bar(Mcap_985_Pro, "LocSamp", fill="its2_type_profile", title="Mcap_985_Pro")+
    scale_fill_manual(values=profile.colors)+
  theme_bw()+
   theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
   theme(legend.position="none");Mcap_985_PRO_plot
ggsave("Mcap_985_PRO_plot.pdf")

#959
 #reorder factor for plotting to make plots in order
sample_data(Mcap_959_Pro)$LocSamp <- factor(sample_data(Mcap_959_Pro)$LocSamp, levels = c("Branch tip_W1", 
    "Branch tip_W4", "Branch tip_W9","Branch tip_W12", "Branch mid_W2","Branch mid_W5","Branch mid_W10" , "Branch mid_W13" ,"Branch base_W3","Branch base_W6","Branch base_W11", "Branch base_W14","Lowest_W8","Lowest_W16","Deepest_W7", "Deepest_W15"))

Mcap_959_PRO_plot<-plot_bar(Mcap_959_Pro, "LocSamp", fill="its2_type_profile", title="Mcap_959_Pro")+
    scale_fill_manual(values=profile.colors)+
  theme_bw()+
   theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
   theme(legend.position="none");Mcap_959_PRO_plot
ggsave("Mcap_959_PRO_plot.pdf")

#980
 #reorder factor for plotting to make plots in order
sample_data(Mcap_980_Pro)$LocSamp <- factor(sample_data(Mcap_980_Pro)$LocSamp, levels = c("Branch tip_X1"
,    "Branch tip_X9",  "Branch mid_X2","Branch mid_X10","Branch base_X3","Branch base_X11", "Plate top_X4","Plate top_X12", "Plate edge_X5","Plate edge_X13","Plate underside_X6", "Plate underside_X14","Lowest_X8","Lowest_X16","Deepest_X7","Deepest_X15"))
Mcap_980_PRO_plot<-plot_bar(Mcap_980_Pro, "LocSamp", fill="its2_type_profile", title="Mcap_980_Pro")+
    scale_fill_manual(values=profile.colors)+
  theme_bw()+
   theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
   theme(legend.position="none");Mcap_980_PRO_plot
ggsave("Mcap_980_PRO_plot.pdf")


# 
# Mcap_DIV_PRO_plot1 <- ggarrange(Mcap_970_PRO_plot, Mcap_965_PRO_plot,Mcap_969_PRO_plot,Mcap_972_PRO_plot, Mcap_971_PRO_plot,Mcap_968_PRO_plot,Mcap_966_PRO_plot,Mcap_978_PRO_plot,
#                     #labels = c("A", "B", "C","D","E","F"),
#                     ncol = 4, nrow = 2);Mcap_DIV_PRO_plot1
# 
# Mcap_DIV_PRO_plot2 <- ggarrange(Mcap_963_PRO_plot, Mcap_961_PRO_plot,Mcap_981_PRO_plot,Mcap_967_PRO_plot,
# Mcap_983_PRO_plot,Mcap_974_PRO_plot,Mcap_984_PRO_plot,Mcap_962_PRO_plot,
#                     #labels = c("A", "B", "C","D","E","F"),
#                     ncol = 4, nrow = 2);Mcap_DIV_PRO_plot2
# 
# Mcap_DIV_PRO_plot3 <- ggarrange(Mcap_957_PRO_plot,Mcap_945_PRO_plot,Mcap_960_PRO_plot,Mcap_976_PRO_plot,
# Mcap_985_PRO_plot,Mcap_964_PRO_plot,Mcap_985_PRO_plot,Mcap_964_PRO_plot,Mcap_985_PRO_plot,Mcap_959_PRO_plot,Mcap_980_PRO_plot,
#                     #labels = c("A", "B", "C","D","E","F"),
#                     ncol = 4, nrow = 3);Mcap_DIV_PRO_plot3
# 
# 
# Mcap_DIV_PRO_plot1 <- ggarrange(Mcap_970_PRO_plot, Mcap_965_PRO_plot,Mcap_969_PRO_plot,Mcap_972_PRO_plot, 
#                     ncol = 4, nrow = 2);Mcap_DIV_PRO_plot1

```

Plots CLADE
```{r}   

# library("RColorBrewer")
# getPalette = colorRampPalette(brewer.pal(8, "Dark2"))
# 
# speciesList = unique(tax_table(Pro_RelA)[,"clade"])
# speciesPalette = getPalette(length(speciesList))
# names(speciesPalette) = speciesList
# 
# scale_color_manual(values=speciesPalette)
# scale_fill_manual(values= speciesPalette)

#this works but you need better pallet color = grDevices::colors()[grep('gr(a|e)y', grDevices::colors(), invert = T)]
clade.colors <- c(C = "deepskyblue", D = "orange")



# pretty the axis labels with ggplot2
# Mcap_970_clade_plot + theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1))+
#   scale_fill_brewer(palette="Paired")


Mcap_970_clade_plot<-plot_bar(Mcap_970_Pro, "LocSamp",fill="clade", title="Mcap_970_clade")+
  scale_fill_manual(values=clade.colors)+
   theme(legend.position="none") + 
  theme(axis.text.x = element_text(angle = 90))+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"));Mcap_970_clade_plot
ggsave("Mcap_970_clade_plot.pdf")


Mcap_965_clade_plot<-plot_bar(Mcap_965_Pro, "LocSamp", fill="clade", title="Mcap_965_clade")+
    scale_fill_manual(values=clade.colors)+
   theme(legend.position="none") +  theme(axis.text.x = element_text(angle = 90))+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"));Mcap_965_clade_plot
ggsave("Mcap_965_clade_plot.pdf")


Mcap_969_clade_plot<-plot_bar(Mcap_969_Pro, "LocSamp", fill="clade", title="Mcap_969_clade")+
    scale_fill_manual(values=clade.colors)+
   theme(legend.position="none") +  theme(axis.text.x = element_text(angle = 90))+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"));Mcap_969_clade_plot
ggsave("Mcap_969_clade_plot.pdf")


Mcap_972_clade_plot<-plot_bar(Mcap_972_Pro, "LocSamp", fill="clade", title="Mcap_972_clade")+
    scale_fill_manual(values=clade.colors)+
   theme(legend.position="none") +  theme(axis.text.x = element_text(angle = 90))+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"));Mcap_972_clade_plot
ggsave("Mcap_972_clade_plot.pdf")


Mcap_971_clade_plot<-plot_bar(Mcap_971_Pro, "LocSamp", fill="clade", title="Mcap_971_clade")+
    scale_fill_manual(values=clade.colors)+
   theme(legend.position="none") +  theme(axis.text.x = element_text(angle = 90))+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"));Mcap_971_clade_plot
ggsave("Mcap_971_clade_plot.pdf")


Mcap_968_clade_plot<-plot_bar(Mcap_968_Pro, "LocSamp", fill="clade", title="Mcap_968_clade")+
    scale_fill_manual(values=clade.colors)+
   theme(legend.position="none") +  theme(axis.text.x = element_text(angle = 90))+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"));Mcap_968_clade_plot
ggsave("Mcap_968_clade_plot.pdf")


Mcap_966_clade_plot<-plot_bar(Mcap_966_Pro, "LocSamp", fill="clade", title="Mcap_966_clade")+
    scale_fill_manual(values=clade.colors)+
   theme(legend.position="none") +  theme(axis.text.x = element_text(angle = 90))+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"));Mcap_966_clade_plot
ggsave("Mcap_966_clade_plot.pdf")


Mcap_978_clade_plot<-plot_bar(Mcap_978_Pro, "LocSamp", fill="clade", title="Mcap_978_clade")+
    scale_fill_manual(values=clade.colors)+
   theme(legend.position="none") +  theme(axis.text.x = element_text(angle = 90))+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"));Mcap_978_clade_plot
ggsave("Mcap_978_clade_plot.pdf")


Mcap_963_clade_plot<-plot_bar(Mcap_963_Pro, "LocSamp", fill="clade", title="Mcap_963_clade")+
    scale_fill_manual(values=clade.colors)+
   theme(legend.position="none") +  theme(axis.text.x = element_text(angle = 90))+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"));Mcap_963_clade_plot
ggsave("Mcap_963_clade_plot.pdf")


Mcap_961_clade_plot<-plot_bar(Mcap_961_Pro, "LocSamp", fill="clade", title="Mcap_961_clade")+
    scale_fill_manual(values=clade.colors)+
   theme(legend.position="none") +  theme(axis.text.x = element_text(angle = 90))+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"));Mcap_961_clade_plot
ggsave("Mcap_961_clade_plot.pdf")


Mcap_981_clade_plot<-plot_bar(Mcap_981_Pro, "LocSamp", fill="clade", title="Mcap_981_clade")+
    scale_fill_manual(values=clade.colors)+
   theme(legend.position="none") +  theme(axis.text.x = element_text(angle = 90))+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"));Mcap_981_clade_plot
ggsave("Mcap_981_clade_plot.pdf")


Mcap_967_clade_plot<-plot_bar(Mcap_967_Pro, "LocSamp", fill="clade", title="Mcap_967_clade")+
    scale_fill_manual(values=clade.colors)+
   theme(legend.position="none") +  theme(axis.text.x = element_text(angle = 90))+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"));Mcap_967_clade_plot
ggsave("Mcap_967_clade_plot.pdf")


Mcap_983_clade_plot<-plot_bar(Mcap_983_Pro, "LocSamp", fill="clade", title="Mcap_983_clade")+
    scale_fill_manual(values=clade.colors)+
   theme(legend.position="none") +  theme(axis.text.x = element_text(angle = 90))+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"));Mcap_983_clade_plot
ggsave("Mcap_983_clade_plot.pdf")


Mcap_974_clade_plot<-plot_bar(Mcap_974_Pro, "LocSamp", fill="clade", title="Mcap_974_clade")+
    scale_fill_manual(values=clade.colors)+
   theme(legend.position="none") +  theme(axis.text.x = element_text(angle = 90))+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"));Mcap_974_clade_plot
ggsave("Mcap_974_clade_plot.pdf")


Mcap_984_clade_plot<-plot_bar(Mcap_984_Pro, "LocSamp", fill="clade", title="Mcap_984_clade")+
    scale_fill_manual(values=clade.colors)+
   theme(legend.position="none") +  theme(axis.text.x = element_text(angle = 90))+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"));Mcap_984_clade_plot
ggsave("Mcap_984_clade_plot.pdf")


Mcap_962_clade_plot<-plot_bar(Mcap_962_Pro, "LocSamp", fill="clade", title="Mcap_962_clade")+
    scale_fill_manual(values=clade.colors)+
   theme(legend.position="none") +  theme(axis.text.x = element_text(angle = 90))+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"));Mcap_962_clade_plot
ggsave("Mcap_962_clade_plot.pdf")


Mcap_957_clade_plot<-plot_bar(Mcap_957_Pro, "LocSamp", fill="clade", title="Mcap_957_clade")+
    scale_fill_manual(values=clade.colors)+
   theme(legend.position="none") +  theme(axis.text.x = element_text(angle = 90))+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"));Mcap_957_clade_plot
ggsave("Mcap_957_clade_plot.pdf")


Mcap_945_clade_plot<-plot_bar(Mcap_945_Pro, "LocSamp", fill="clade", title="Mcap_945_clade")+
    scale_fill_manual(values=clade.colors)+
   theme(legend.position="none") +  theme(axis.text.x = element_text(angle = 90))+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"));Mcap_945_clade_plot
ggsave("Mcap_945_clade_plot.pdf")


Mcap_960_clade_plot<-plot_bar(Mcap_960_Pro, "LocSamp", fill="clade", title="Mcap_960_clade")+
    scale_fill_manual(values=clade.colors)+
   theme(legend.position="none") +  theme(axis.text.x = element_text(angle = 90))+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"));Mcap_960_clade_plot
ggsave("Mcap_960_clade_plot.pdf")


Mcap_976_clade_plot<-plot_bar(Mcap_976_Pro, "LocSamp", fill="clade", title="Mcap_976_clade")+
    scale_fill_manual(values=clade.colors)+
   theme(legend.position="none") +  theme(axis.text.x = element_text(angle = 90))+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"));Mcap_976_clade_plot
ggsave("Mcap_976_clade_plot.pdf")


Mcap_985_clade_plot<-plot_bar(Mcap_985_Pro, "LocSamp", fill="clade", title="Mcap_985_clade")+
    scale_fill_manual(values=clade.colors)+
   theme(legend.position="none") +  theme(axis.text.x = element_text(angle = 90))+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"));Mcap_985_clade_plot
ggsave("Mcap_985_clade_plot.pdf")


Mcap_964_clade_plot<-plot_bar(Mcap_964_Pro, "LocSamp", fill="clade", title="Mcap_964_clade")+
    scale_fill_manual(values=clade.colors)+
   theme(legend.position="none") +  theme(axis.text.x = element_text(angle = 90))+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"));Mcap_964_clade_plot
ggsave("Mcap_964_clade_plot.pdf")


Mcap_985_clade_plot<-plot_bar(Mcap_985_Pro, "LocSamp", fill="clade", title="Mcap_985_clade")+
    scale_fill_manual(values=clade.colors)+
   theme(legend.position="none") +  theme(axis.text.x = element_text(angle = 90))+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"));Mcap_985_clade_plot
ggsave("Mcap_985_clade_plot.pdf")


Mcap_959_clade_plot<-plot_bar(Mcap_959_Pro, "LocSamp", fill="clade", title="Mcap_959_clade")+
    scale_fill_manual(values=clade.colors)+
   theme(legend.position="none") +  theme(axis.text.x = element_text(angle = 90))+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"));Mcap_959_clade_plot
ggsave("Mcap_959_clade_plot.pdf")


Mcap_980_clade_plot<-plot_bar(Mcap_980_Pro, "LocSamp", fill="clade", title="Mcap_980_clade")+
    scale_fill_manual(values=clade.colors)+
   theme(legend.position="none")+theme(axis.text.x = element_text(angle = 90))+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"));Mcap_980_clade_plot
ggsave("Mcap_980_clade_plot.pdf")

```



Plot all clade level by colony
```{r} 
theme_set(theme_classic())
library(ggpubr)

library(ggarrange)


figureMCL1 <- ggarrange(Mcap_970_clade_plot, Mcap_965_clade_plot, Mcap_969_clade_plot,Mcap_972_clade_plot, 
                               Mcap_970_PRO_plot, Mcap_965_PRO_plot, Mcap_969_PRO_plot, Mcap_972_PRO_plot, 
                               Mcap_970_plot, Mcap_965_plot, Mcap_969_plot, Mcap_972_plot, 
                    ncol = 4, nrow = 3);figureMCL1

figureMCL2 <- ggarrange(Mcap_971_clade_plot,Mcap_968_clade_plot,Mcap_966_clade_plot,Mcap_978_clade_plot, 
                        Mcap_971_PRO_plot,Mcap_968_PRO_plot,Mcap_966_PRO_plot,Mcap_978_PRO_plot, 
                        Mcap_971_plot,Mcap_968_plot,Mcap_966_plot,Mcap_978_plot, 
                    ncol = 4, nrow = 3);figureMCL2

figureMCL3 <- ggarrange(Mcap_963_clade_plot, Mcap_961_clade_plot,Mcap_981_clade_plot,Mcap_967_clade_plot,
                        Mcap_963_PRO_plot, Mcap_961_PRO_plot,Mcap_981_PRO_plot,Mcap_967_PRO_plot,
                        Mcap_963_plot, Mcap_961_plot,Mcap_981_plot,Mcap_967_plot,
                    ncol = 4, nrow = 3);figureMCL3

figureMCL4 <- ggarrange(Mcap_983_clade_plot, Mcap_974_clade_plot,Mcap_984_clade_plot,Mcap_962_clade_plot, 
                        Mcap_983_PRO_plot, Mcap_974_PRO_plot,Mcap_984_PRO_plot,Mcap_962_PRO_plot, 
                        Mcap_983_plot,Mcap_974_plot,Mcap_984_plot,Mcap_962_plot, 
                    ncol = 4, nrow = 3);figureMCL4

figureMCL5 <- ggarrange(Mcap_957_clade_plot, Mcap_945_clade_plot,Mcap_960_clade_plot,Mcap_976_clade_plot,
                        Mcap_957_PRO_plot,Mcap_945_PRO_plot,Mcap_960_PRO_plot,Mcap_976_PRO_plot,
                        Mcap_957_plot,Mcap_945_plot,Mcap_960_plot,Mcap_976_plot,
                    ncol = 4, nrow = 3);figureMCL5


figureMCL6 <- ggarrange(Mcap_985_clade_plot, Mcap_964_clade_plot, Mcap_959_clade_plot,Mcap_980_clade_plot,
                        Mcap_985_PRO_plot, Mcap_964_PRO_plot, Mcap_959_PRO_plot,Mcap_980_PRO_plot,
                        Mcap_985_plot,Mcap_964_plot,Mcap_959_plot,Mcap_980_plot,
                    ncol = 4, nrow = 3);figureMCL6



```

Ordination OLD
```{r}
plot_ordination(coralDIV2.prune, ordinate(coralDIV2.prune, "MDS"), color = "TagID") + geom_point(size = 5)
plot_heatmap(coralDIV2.prune, "NMDS", "bray", "TagID", "DIV")

GP.ord <- ordinate(coralDIV2.prune, "NMDS", "bray")
p1 = plot_ordination(coralDIV2.prune, GP.ord, type="samples", color="TagID", title="taxa")
print(p1)

p2 = plot_ordination(coralDIV2.prune, GP.ord, type="samples", color="TagID", shape="TagID") 
p2 + geom_polygon(aes(fill=SampleType)) + geom_point(size=5) + ggtitle("samples")
```



# PERMANOVA coralDIV2.prune (older)

Write specific questions to answer:
-do algal communities differ between colonies? 
-do algal communities differ within colonies
-do they differ between C-only and D-only? 
-is there a dominant C type or D type
- check hypotheses based on location (tips vs branches) across entire dataset and by dom clade
```{r}            
# use this  
otu_table(DIV_RelA)[1:5, 1:5] #check rela worked

#bray curtis presence-absense and abundance
 
  DIV_RelA = prune_taxa(taxa_sums(DIV_RelA) > 0, DIV_RelA) #this removes any OTU with 0s

#bray curtis presence-absense and abundance

#all speices
set.seed(300)

#make bray curtis data matrix
bc.all <- phyloseq::distance(DIV_RelA, method = "bray")
  samp.df <- as(sample_data(coralDIV2.prune_stats), "data.frame") #sample df
  
  samp.df$TagID<-as.factor(samp.df$TagID)
    samp.df$Land_Ocean<-as.factor(samp.df$Land_Ocean)
    samp.df$SampLoc<-as.factor(samp.df$SampLoc)
    samp.df$Location<-paste(samp.df$SampLoc, samp.df$Sub.loc) #sample location and sub location
  
#adonis test
adonis2(bc.all ~ TagID*Location, data = samp.df) #all sig
    # genotype, sample location and interaction all significant. 

# Homogeneity of dispersion test
beta.colony <- betadisper(bc.all, samp.df$TagID)
perm<-permutest(beta.colony, pairwise = T) 
(bc.all.HSD <- TukeyHSD(beta.colony)) #do you need?
plot(bc.all.HSD)


#Ordination NMDS for all species
set.seed(30)
ord.DIV_bc.all <- ordinate(coralDIV2.prune_stats, "NMDS", "bray", trymax = 300)  ### NO CONVERGENCE
stressplot(ord.DIV_bc.all)
ord.DIV_bc.all <- as.data.frame(cbind(vegan::scores(ord.DIV_bc.all, display="sites"))) #make df
ord.DIV_bc.all$TagID <- samp.df$TagID
ord.DIV_bc.all$SampLoc <- samp.df$SampLoc
ord.DIV_bc.all$Zoox <- samp.df$Zoox

ggplot(ord.DIV_bc.all, aes(x = NMDS1, y = NMDS2)) + 
  geom_point(aes(colour = TagID), size = 4,show.legend=T) +
  #scale_color_manual(values=Sp.colors)+
  # geom_text(label = rownames(Clade), nudge_x = 0.05, nudge_y = 0.05,check_overlap = T) +
  stat_ellipse(aes(x = NMDS1, y = NMDS2, colour = TagID), linetype = 2,show.legend=T) +
  ggtitle("NMDS its2 Bray Curtis genotype ") +
  theme_classic()
#ggsave("bc_all.pdf")

ggplot(ord.DIV_bc.all, aes(x = NMDS1, y = NMDS2, color = TagID )) +
  geom_point(aes(colour=TagID), size=4) +
  stat_ellipse(geom = "polygon",
               aes(fill = TagID), 
               alpha = 0.25)+
    theme_classic()

zoox.cols <- c("C" = "green2","CD"="darkslateblue","D"="darkorange")

ggplot(ord.DIV_bc.all, aes(x = NMDS1, y = NMDS2, color = Zoox )) +
  geom_point(aes(colour=Zoox), size=5, alpha=0.8) +
      scale_color_manual(values=zoox.cols)+
  # stat_ellipse(geom = "polygon",
  #              aes(fill = Zoox), 
  #              alpha = 0.2)+
    theme_classic()

######### Try by Cs only #### 
coralDIV2.prune_stats_C<-subset_samples(coralDIV2.prune_stats, Zoox=="C")
coralDIV2.prune_stats_C = prune_taxa(taxa_sums(coralDIV2.prune_stats_C) > 0, coralDIV2.prune_stats_C)
  
set.seed(30)
ord.DIV_bc.C <- ordinate(coralDIV2.prune_stats_C, "NMDS", "bray", trymax = 300)  ### NO CONVERGENCE
stressplot(ord.DIV_bc.C)
  samp.df.C <- as(sample_data(coralDIV2.prune_stats_C), "data.frame") #sample df

ord.DIV_bc.C <- as.data.frame(cbind(vegan::scores(ord.DIV_bc.C, display="sites"))) #make df
ord.DIV_bc.C$TagID <- samp.df.C$TagID
ord.DIV_bc.C$TagID<-as.factor(ord.DIV_bc.C$TagID)
ord.DIV_bc.C$SampLoc <- samp.df.C$SampLoc
ord.DIV_bc.C$Location<-samp.df.C$Sub.loc
ord.DIV_bc.C$Code<-paste(ord.DIV_bc.C$SampLoc, ord.DIV_bc.C$Location)
ord.DIV_bc.C$Code<-as.factor(ord.DIV_bc.C$Code)

ggplot(ord.DIV_bc.C, aes(x = NMDS1, y = NMDS2)) + 
  geom_point(aes(colour = TagID), size = 4,show.legend=T) +
  #scale_color_manual(values=Sp.colors)+
  # geom_text(label = rownames(Clade), nudge_x = 0.05, nudge_y = 0.05,check_overlap = T) +
  stat_ellipse(aes(x = NMDS1, y = NMDS2, colour = TagID),show.legend=T) +
  ggtitle("NMDS its2 C only ") +
  theme_classic()
#ggsave("bc_all.pdf")

ggplot(ord.DIV_bc.C, aes(x = NMDS1, y = NMDS2, color = Code, linetype=Code)) +
  geom_point(aes(shape=Code), size=4) +
  stat_ellipse(geom = "polygon",
               aes(fill = Code), 
               alpha = 0.25)+
    theme_classic()

ggplot(ord.DIV_bc.C, aes(x = NMDS1, y = NMDS2)) + 
  geom_point(aes(colour = Code), size = 4,show.legend=T) +
  #scale_Dolor_manual(values=Sp.Dolors)+
  # geom_text(label = rownames(Clade), nudge_x = 0.05, nudge_y = 0.05,check_overlap = T) +
  # stat_ellipse(aes(x = NMDS1, y = NMDS2, colour = Code),show.legend=T) +
    geom_mark_hull(concavity = 5,expand=0,radius=0,aes(fill=Code))+
  ggtitle("NMDS its2 C only ") +
  theme_classic()
#ggsave("bc_all.pdf")



ggplot(ord.DIV_bc.C, aes(x = NMDS1, y = NMDS2)) + 
  geom_point(aes(colour = Code), size = 4,show.legend=T) +
  #scale_Dolor_manual(values=Sp.Dolors)+
  # geom_text(label = rownames(Clade), nudge_x = 0.05, nudge_y = 0.05,check_overlap = T) +
  # stat_ellipse(aes(x = NMDS1, y = NMDS2, colour = Code),show.legend=T) +
  geom_mark_ellipse(expand = 0,aes(fill=Code))+
  ggtitle("NMDS its2 C only ") +
  theme_classic()
#ggsave("bc_all.pdf")




######### Try by Ds only #### 
coralDIV2.prune_stats_D<-subset_samples(coralDIV2.prune_stats, Zoox=="D")
coralDIV2.prune_stats_D = prune_taxa(taxa_sums(coralDIV2.prune_stats_D) > 0, coralDIV2.prune_stats_D)
  
set.seed(300)
ord.DIV_bc.D <- ordinate(coralDIV2.prune_stats_D, "NMDS", "bray", trymax = 500)  #
stressplot(ord.DIV_bc.D)
  samp.df.D <- as(sample_data(coralDIV2.prune_stats_D), "data.frame") #sample df

ord.DIV_bc.D <- as.data.frame(cbind(vegan::scores(ord.DIV_bc.D, display="sites"))) #make df
ord.DIV_bc.D$TagID <- samp.df.D$TagID
ord.DIV_bc.D$TagID<-as.factor(ord.DIV_bc.D$TagID)
ord.DIV_bc.D$SampLoc <- samp.df.D$SampLoc
ord.DIV_bc.D$Location<-samp.df.D$Sub.loc
ord.DIV_bc.D$Code<-paste(ord.DIV_bc.D$SampLoc, ord.DIV_bc.D$Location)
ord.DIV_bc.D$Code<-as.factor(ord.DIV_bc.D$Code)

ggplot(ord.DIV_bc.D, aes(x = NMDS1, y = NMDS2)) + 
  geom_point(aes(colour = TagID), size = 4,show.legend=T) +
  #scale_Dolor_manual(values=Sp.Dolors)+
  # geom_text(label = rownames(Clade), nudge_x = 0.05, nudge_y = 0.05,check_overlap = T) +
  stat_ellipse(aes(x = NMDS1, y = NMDS2, colour = TagID),show.legend=T) +
  ggtitle("NMDS its2 D only ") +
  theme_classic()
#ggsave("bc_all.pdf")


library(ggalt)
library(ggforce)
library(concaveman)

ggplot(ord.DIV_bc.D, aes(x = NMDS1, y = NMDS2)) + 
  geom_point(aes(colour = Code), size = 4,show.legend=T) +
  #scale_Dolor_manual(values=Sp.Dolors)+
  # geom_text(label = rownames(Clade), nudge_x = 0.05, nudge_y = 0.05,check_overlap = T) +
  # stat_ellipse(aes(x = NMDS1, y = NMDS2, colour = Code),show.legend=T) +
    geom_mark_hull(concavity = 5,expand=0,radius=0,aes(fill=Code))+
  ggtitle("NMDS its2 D only ") +
  theme_classic()
#ggsave("bc_all.pdf")


ggplot(ord.DIV_bc.D, aes(x = NMDS1, y = NMDS2, color = Code, linetype=Code)) +
  geom_point(aes(colour=Code), size=4) +
  stat_ellipse(geom = "polygon",
               aes(fill = Code), 
               alpha = 0.25)+
    theme_classic()





#bray curtis presence-absense and abundance

#all speices
set.seed(30)

#make bray curtis data matrix
bc.all <- phyloseq::distance(DIV_RelA_stats, method = "bray")
  samp.df <- as(sample_data(DIV_RelA_stats), "data.frame") #sample df
#adonis test
adonis(bc.all ~ Species*Time.Point*Treatment, data = samp.df)
    

# Homogeneity of dispersion test
betaAll <- betadisper(bc.all, samp.df$Species)
permutest(betaAll, pairwise = T) 
(bc.all.HSD <- TukeyHSD(betaAll)) #do you need?
plot(bc.all.HSD)


#Ordination NMDS for all species
set.seed(30)
ord.DIV_RelA_stats <- ordinate(DIV_RelA_stats, "NMDS", "bray", trymax = 100) 
stressplot(ord.DIV_RelA_stats)
scores.ord.DIV_RelA_stats <- as.data.frame(cbind(vegan::scores(ord.DIV_RelA_stats, display="sites"))) #make df
scores.ord.DIV_RelA_stats$Treatment <- samp.df$Treatment
scores.ord.DIV_RelA_stats$Species <- samp.df$Species
scores.ord.DIV_RelA_stats$Clade <- samp.df$Clade
scores.ord.DIV_RelA_stats$Time.Point <- samp.df$Time.Point

ggplot(scores.ord.DIV_RelA_stats, aes(x = NMDS1, y = NMDS2)) + 
  geom_point(aes(colour = Species), size = 4) +
  #scale_color_manual(values=Mcap.Parent.colors)+
  #geom_text(label = rownames(scores), nudge_x = 0.05, nudge_y = 0.05,check_overlap = T) +
  #stat_ellipse(aes(x = NMDS1, y = NMDS2, colour = Treatment), linetype = 2) +
  ggtitle("NMDS its2 Bray Curtis") +
  theme_classic()
#ggsave("bc_all.pdf")

ggplot(scores.ord.DIV_RelA_stats, aes(x = NMDS1, y = NMDS2)) + 
  geom_point(aes(colour = Clade, shape=Species), size = 4) +
  #scale_color_manual(values=Mcap.Parent.colors)+
  #geom_text(label = rownames(scores), nudge_x = 0.05, nudge_y = 0.05,check_overlap = T) +
  #stat_ellipse(aes(x = NMDS1, y = NMDS2, colour = Treatment), linetype = 2) +
  ggtitle("NMDS its2 Bray Curtis") +
  theme_classic()
#ggsave("bc_all.pdf")



######### Try by CDs only #### 
coralDIV2.prune_stats_CD<-subset_samples(coralDIV2.prune_stats, Zoox=="CD")
coralDIV2.prune_stats_CD = prune_taxa(taxa_sums(coralDIV2.prune_stats_CD) > 0, coralDIV2.prune_stats_CD)
  
set.seed(30)
ord.DIV_bc.CD <- ordinate(coralDIV2.prune_stats_CD, "NMDS", "bray", trymax = 300)  ###  CONVERGENCE
stressplot(ord.DIV_bc.CD)
  samp.df.CD <- as(sample_data(coralDIV2.prune_stats_CD), "data.frame") #sample df

ord.DIV_bc.CD <- as.data.frame(cbind(vegan::scores(ord.DIV_bc.CD, display="sites"))) #make df
ord.DIV_bc.CD$TagID <- samp.df.CD$TagID
ord.DIV_bc.CD$TagID<-as.factor(ord.DIV_bc.CD$TagID)
ord.DIV_bc.CD$SampLoc <- samp.df.CD$SampLoc
ord.DIV_bc.CD$Location<-samp.df.CD$Sub.loc
ord.DIV_bc.CD$Code<-paste(ord.DIV_bc.CD$SampLoc, ord.DIV_bc.CD$Location)
ord.DIV_bc.CD$Code<-as.factor(ord.DIV_bc.CD$Code)

ggplot(ord.DIV_bc.CD, aes(x = NMDS1, y = NMDS2)) + 
  geom_point(aes(colour = TagID), size = 4,show.legend=T) +
  #scale_CDolor_manual(values=Sp.CDolors)+
  # geom_text(label = rownames(Clade), nudge_x = 0.05, nudge_y = 0.05,check_overlap = T) +
  stat_ellipse(aes(x = NMDS1, y = NMDS2, colour = TagID),show.legend=T) +
  ggtitle("NMDS its2 CD only ") +
  theme_classic()
#ggsave("bc_all.pdf")

ggplot(ord.DIV_bc.CD, aes(x = NMDS1, y = NMDS2, color = TagID)) +
  geom_point(aes(colour=TagID), size=4, alpha=.2) +
  stat_ellipse(geom = "polygon",
               aes(fill = TagID), 
               alpha = 0.55)+
    theme_classic()

ggplot(ord.DIV_bc.CD, aes(x = NMDS1, y = NMDS2)) + 
  geom_point(aes(colour = Code), size = 4,show.legend=T) +
  #scale_Dolor_manual(values=Sp.Dolors)+
  # geom_text(label = rownames(Clade), nudge_x = 0.05, nudge_y = 0.05,check_overlap = T) +
  # stat_ellipse(aes(x = NMDS1, y = NMDS2, colour = Code),show.legend=T) +
    geom_mark_hull(concavity = 5,expand=0,radius=0,aes(fill=Code))+
  ggtitle("NMDS its2 CD only ") +
  theme_classic()
#ggsave("bc_all.pdf")



##############   BY COLONY   ##################

#945 ####
DIV_RelA_stats_945<-subset_samples(coralDIV2.prune_stats, TagID=="945")
  DIV_RelA_stats_945 = prune_taxa(taxa_sums(DIV_RelA_stats_945) > 0, DIV_RelA_stats_945) #this removes any OTU with 0s
  samp.df_945 <- as(sample_data(DIV_RelA_stats_945), "data.frame") #sample df

#all speices
set.seed(30)

#make bray curtis data matrix
bc.945 <- phyloseq::distance(coralDIV2.prune_stats, method = "bray")
  samp.df_945 <- as(sample_data(coralDIV2.prune_stats), "data.frame") #sample df
#adonis test
adonis(bc.945 ~ SampLoc, data = samp.df_945)
    


#Ordination NMDS for all species
set.seed(30)
ord.DIV_RelA_stats.945 <- ordinate(DIV_RelA_stats_945, "NMDS", "bray", trymax = 100)
  samp.df_945 <- as(sample_data(DIV_RelA_stats_945), "data.frame") #sample df
stressplot(ord.DIV_RelA_stats.945)
ord.DIV_RelA_stats.945 <- as.data.frame(cbind(vegan::scores(ord.DIV_RelA_stats.945, display="sites"))) #make df
ord.DIV_RelA_stats.945$SampLoc <- samp.df_945$SampLoc
ord.DIV_RelA_stats.945$sample_name <- samp.df_945$sample_name
ord.DIV_RelA_stats.945$Code<-paste(ord.DIV_RelA_stats.945$SampLoc,samp.df_945$Sub.loc)

ggplot(ord.DIV_RelA_stats.945, aes(x = NMDS1, y = NMDS2)) + 
  geom_point(aes(colour = Code), size = 7) +
  #scale_color_manual(values=Mcap.Parent.colors)+
  #geom_text(label = rownames(scores), nudge_x = 0.05, nudge_y = 0.05,check_overlap = T) +
  ggtitle("NMDS its2 Bray Curtis 945") +
  theme_classic() 
#ggsave("bc_all.pdf")

ggplot(ord.DIV_RelA_stats.945, aes(x = NMDS1, y = NMDS2)) + 
  geom_point(aes(colour = Code), size = 4,show.legend=T) +
  #scale_Dolor_manual(values=Sp.Dolors)+
  # geom_text(label = rownames(Clade), nudge_x = 0.05, nudge_y = 0.05,check_overlap = T) +
  # stat_ellipse(aes(x = NMDS1, y = NMDS2, colour = Code),show.legend=T) +
  geom_mark_ellipse(expand = 0,aes(fill=Code))+
  ggtitle("NMDS its2 945 only ") +
  theme_classic()
#ggsave("bc_all.pdf")





# for defense old code for code #### 

ggplot(scores.ord.DIV_RelA_stats, aes(x = NMDS1, y = NMDS2, color = Species, linetype=Treatment)) +
  geom_point(aes(shape=Treatment), size=4) +
  stat_ellipse(geom = "polygon",
               aes(fill = Code3), 
               alpha = 0.25)+
    theme_classic()

scores.ord.DIV_RelA_stats$Code4<-paste(scores.ord.DIV_RelA_stats$Species, scores.ord.DIV_RelA_stats$Clade, scores.ord.DIV_RelA_stats$Treatment)

 p<-ggplot(scores.ord.DIV_RelA_stats, aes(x = NMDS1, y = NMDS2, color = Species, linetype=Treatment)) +
  geom_point(aes(shape=Treatment), size=4) +
  stat_ellipse(geom = "polygon",
               aes(fill = Code4), 
               alpha = 0.25)+
    theme_classic()
p+facet_wrap(~Species)



#960 ####
DIV_RelA_stats_960<-subset_samples(coralDIV2.prune_stats, TagID=="960")
  DIV_RelA_stats_960 = prune_taxa(taxa_sums(DIV_RelA_stats_960) > 0, DIV_RelA_stats_960) #this removes any OTU with 0s
  samp.df_960 <- as(sample_data(DIV_RelA_stats_960), "data.frame") #sample df

#all speices
set.seed(30)

#make bray curtis data matrix
bc.960 <- phyloseq::distance(coralDIV2.prune_stats, method = "bray")
  samp.df_960 <- as(sample_data(coralDIV2.prune_stats), "data.frame") #sample df
#adonis test
adonis(bc.960 ~ SampLoc, data = samp.df_960)
    
# Homogeneity of dispersion test
# betaAll <- betadisper(bc.960, samp.df$Species)
# permutest(betaAll, pairwise = T) 
# (bc.all.HSD <- TukeyHSD(betaAll)) #do you need?
# plot(bc.all.HSD)

#Ordination NMDS for all species
set.seed(30)
ord.DIV_RelA_stats.960 <- ordinate(DIV_RelA_stats_960, "NMDS", "bray", trymax = 100) 
stressplot(ord.DIV_RelA_stats.960)
  samp.df_960 <- as(sample_data(DIV_RelA_stats_960), "data.frame") #sample df
ord.DIV_RelA_stats.960 <- as.data.frame(cbind(vegan::scores(ord.DIV_RelA_stats.960, display="sites"))) #make df
ord.DIV_RelA_stats.960$SampLoc <- samp.df_960$SampLoc
ord.DIV_RelA_stats.960$sample_name <- samp.df_960$sample_name
ord.DIV_RelA_stats.960$Location <- samp.df_960$Location

ord.DIV_RelA_stats.960$Code<-paste(ord.DIV_RelA_stats.960$SampLoc, ord.DIV_RelA_stats.960$Location)
ggplot(ord.DIV_RelA_stats.960, aes(x = NMDS1, y = NMDS2)) + 
  geom_point(aes(colour = Location), size = 7) +
  #scale_color_manual(values=Mcap.Parent.colors)+
  #geom_text(label = rownames(scores), nudge_x = 0.05, nudge_y = 0.05,check_overlap = T) +
  ggtitle("NMDS its2 Bray Curtis 960") +
  theme_classic() 

#ggsave("bc_all.pdf")
ggplot(ord.DIV_RelA_stats.960, aes(x = NMDS1, y = NMDS2)) + 
  geom_point(aes(colour = Land_Ocean, shape=Code), size = 4) +
  #scale_color_manual(values=Mcap.Parent.colors)+
  #geom_text(label = rownames(scores), nudge_x = 0.05, nudge_y = 0.05,check_overlap = T) +
  ggtitle("NMDS its2 Bray Curtis 960") +
  theme_classic() 
#ggsave("bc_all.pdf")

ggplot(ord.DIV_RelA_stats.960, aes(x = NMDS1, y = NMDS2)) + 
  geom_point(aes(colour = Code), size = 4,show.legend=T) +
  #scale_Dolor_manual(values=Sp.Dolors)+
  # geom_text(label = rownames(Clade), nudge_x = 0.05, nudge_y = 0.05,check_overlap = T) +
  # stat_ellipse(aes(x = NMDS1, y = NMDS2, colour = Code),show.legend=T) +
  geom_mark_ellipse(expand = 0,aes(fill=Code))+
  ggtitle("NMDS its2 960 only ") +
  theme_classic()
#ggsave("bc_all.pdf")

#970 ####
DIV_RelA_stats_970<-subset_samples(coralDIV2.prune_stats, TagID=="970")
  DIV_RelA_stats_970 = prune_taxa(taxa_sums(DIV_RelA_stats_970) > 0, DIV_RelA_stats_970) #this removes any OTU with 0s
  samp.df_970 <- as(sample_data(DIV_RelA_stats_970), "data.frame") #sample df

#all speices
set.seed(30)

#make bray curtis data matrix
bc.970 <- phyloseq::distance(coralDIV2.prune_stats, method = "bray")
  samp.df_970 <- as(sample_data(coralDIV2.prune_stats), "data.frame") #sample df
#adonis test
adonis(bc.970 ~ SampLoc, data = samp.df_970)
    
# Homogeneity of dispersion test
# betaAll <- betadisper(bc.all, samp.df$Species)
# permutest(betaAll, pairwise = T) 
# (bc.all.HSD <- TukeyHSD(betaAll)) #do you need?
# plot(bc.all.HSD)

#Ordination NMDS for all species
set.seed(30)
ord.DIV_RelA_stats.970 <- ordinate(DIV_RelA_stats_970, "NMDS", "bray", trymax = 100) 
stressplot(ord.DIV_RelA_stats.970)
  samp.df_970 <- as(sample_data(DIV_RelA_stats_970), "data.frame") #sample df

ord.DIV_RelA_stats.970 <- as.data.frame(cbind(vegan::scores(ord.DIV_RelA_stats.970, display="sites"))) #make df
ord.DIV_RelA_stats.970$SampLoc <- samp.df_970$SampLoc
ord.DIV_RelA_stats.970$sample_name <- samp.df_970$sample_name
ord.DIV_RelA_stats.970$Sub.loc <- samp.df_970$Sub.loc
ord.DIV_RelA_stats.970$Location<-samp.df_970$Location

ggplot(ord.DIV_RelA_stats.970, aes(x = NMDS1, y = NMDS2)) + 
  geom_point(aes(colour = Location), size = 7) +
  #scale_color_manual(values=Mcap.Parent.colors)+
  #geom_text(label = rownames(scores), nudge_x = 0.05, nudge_y = 0.05,check_overlap = T) +
  # geom_line(aes(group = Location))+
    geom_mark_ellipse(expand = 0,aes(fill=Location))+
  ggtitle("NMDS its2 Bray Curtis 970") +
  theme_classic() 
#ggsave("bc_all.pdf")

ggplot(ord.DIV_RelA_stats.970, aes(x = NMDS1, y = NMDS2)) + 
  geom_point(aes(colour = Location), size = 4,show.legend=T) +
  #scale_Dolor_manual(values=Sp.Dolors)+
  # geom_text(label = rownames(Clade), nudge_x = 0.05, nudge_y = 0.05,check_overlap = T) +
  stat_ellipse(aes(x = NMDS1, y = NMDS2, colour = Location),show.legend=T) +
  # geom_line(aes(group = Location),color="grey")+
  ggtitle("NMDS its2 970 only ") +
  theme_classic()
#ggsave("bc_all.pdf")



#966 ####
DIV_RelA_stats_966<-subset_samples(coralDIV2.prune_stats, TagID=="966")
  DIV_RelA_stats_966 = prune_taxa(taxa_sums(DIV_RelA_stats_966) > 0, DIV_RelA_stats_966) #this removes any OTU with 0s

#all speices
set.seed(30)

#make bray curtis data matrix
bc.966 <- phyloseq::distance(coralDIV2.prune_stats, method = "bray")
  samp.df_966 <- as(sample_data(coralDIV2.prune_stats), "data.frame") #sample df
#adonis test
adonis(bc.966 ~ SampLoc, data = samp.df_966)
    
#Ordination NMDS for all species
set.seed(30)
ord.DIV_RelA_stats.966 <- ordinate(DIV_RelA_stats_966, "NMDS", "bray", trymax = 100) 
stressplot(ord.DIV_RelA_stats.966)
  samp.df_966 <- as(sample_data(DIV_RelA_stats_966), "data.frame") #sample df
ord.DIV_RelA_stats.966 <- as.data.frame(cbind(vegan::scores(ord.DIV_RelA_stats.966, display="sites"))) #make df
ord.DIV_RelA_stats.966$SampLoc <- samp.df_966$SampLoc
ord.DIV_RelA_stats.966$sample_name <- samp.df_966$sample_name
ord.DIV_RelA_stats.966$Code <- paste(samp.df_966$SampLoc, samp.df_966$Sub.loc)


ggplot(ord.DIV_RelA_stats.966, aes(x = NMDS1, y = NMDS2)) + 
  geom_point(aes(colour = Code), size = 4) +
  #scale_color_manual(values=Mcap.Parent.colors)+
  #geom_text(label = rownames(scores), nudge_x = 0.05, nudge_y = 0.05,check_overlap = T) +
  ggtitle("NMDS its2 Bray Curtis 966") +
  theme_classic() 
#ggsave("bc_all.pdf")


ggplot(ord.DIV_RelA_stats.966, aes(x = NMDS1, y = NMDS2)) + 
  geom_point(aes(colour = Code), size = 4,show.legend=T) +
  #scale_Dolor_manual(values=Sp.Dolors)+
  # geom_text(label = rownames(Clade), nudge_x = 0.05, nudge_y = 0.05,check_overlap = T) +
  # stat_ellipse(aes(x = NMDS1, y = NMDS2, colour = Code),show.legend=T) +
  geom_mark_ellipse(expand = 0,aes(fill=Code))+
  ggtitle("NMDS its2 966 only ") +
  theme_classic()
#ggsave("bc_all.pdf")


#981 ####
DIV_RelA_stats_981<-subset_samples(coralDIV2.prune_stats, TagID=="981")
  DIV_RelA_stats_981 = prune_taxa(taxa_sums(DIV_RelA_stats_981) > 0, DIV_RelA_stats_981) #this removes any OTU with 0s

#all speices
set.seed(30)

#make bray curtis data matrix
bc.981 <- phyloseq::distance(coralDIV2.prune_stats, method = "bray")
  samp.df_981 <- as(sample_data(coralDIV2.prune_stats), "data.frame") #sample df
#adonis test
adonis(bc.981 ~ SampLoc, data = samp.df_981)


#Ordination NMDS for all species
set.seed(30)
ord.DIV_RelA_stats.981 <- ordinate(DIV_RelA_stats_981, "NMDS", "bray", trymax = 100) 
stressplot(ord.DIV_RelA_stats.981)
  samp.df_981 <- as(sample_data(DIV_RelA_stats_981), "data.frame") #sample df

ord.DIV_RelA_stats.981 <- as.data.frame(cbind(vegan::scores(ord.DIV_RelA_stats.981, display="sites"))) #make df
ord.DIV_RelA_stats.981$SampLoc <- samp.df_981$SampLoc
ord.DIV_RelA_stats.981$sample_name <- samp.df_981$sample_name
ord.DIV_RelA_stats.981$Location <- samp.df_981$Location

ggplot(ord.DIV_RelA_stats.981, aes(x = NMDS1, y = NMDS2)) + 
  geom_point(aes(colour = Location, shape=Location), size = 4) +
  #scale_color_manual(values=Mcap.Parent.colors)+
  #geom_text(label = rownames(scores), nudge_x = 0.05, nudge_y = 0.05,check_overlap = T) +
  ggtitle("NMDS its2 Bray Curtis 981") +
  theme_classic() 
#ggsave("bc_all.pdf")

ggplot(ord.DIV_RelA_stats.981, aes(x = NMDS1, y = NMDS2)) + 
  geom_point(aes(colour = Location), size = 4,show.legend=T) +
  #scale_Dolor_manual(values=Sp.Dolors)+
  # geom_text(label = rownames(Clade), nudge_x = 0.05, nudge_y = 0.05,check_overlap = T) +
  # stat_ellipse(aes(x = NMDS1, y = NMDS2, colour = Code),show.legend=T) +
  # geom_mark_ellipse(expand = 0,aes(fill=Location))+
    geom_mark_hull(expand = 0,aes(fill=Location))+

  ggtitle("NMDS its2 981 only ") +
  theme_classic()
#ggsave("bc_all.pdf")


#957 ####
DIV_RelA_stats_957<-subset_samples(coralDIV2.prune_stats, TagID=="957")
  DIV_RelA_stats_957 = prune_taxa(taxa_sums(DIV_RelA_stats_957) > 0, DIV_RelA_stats_957) #this removes any OTU with 0s

#all speices
set.seed(30)

#make bray curtis data matrix
bc.957 <- phyloseq::distance(coralDIV2.prune_stats, method = "bray")
  samp.df_957 <- as(sample_data(coralDIV2.prune_stats), "data.frame") #sample df
#adonis test
adonis(bc.957 ~ SampLoc, data = samp.df_957)


#Ordination NMDS for all species
set.seed(30)
ord.DIV_RelA_stats.957 <- ordinate(DIV_RelA_stats_957, "NMDS", "bray", trymax = 100) 
stressplot(ord.DIV_RelA_stats.957)
  samp.df_957 <- as(sample_data(DIV_RelA_stats_957), "data.frame") #sample df

ord.DIV_RelA_stats.957 <- as.data.frame(cbind(vegan::scores(ord.DIV_RelA_stats.957, display="sites"))) #make df
ord.DIV_RelA_stats.957$SampLoc <- samp.df_957$SampLoc
ord.DIV_RelA_stats.957$sample_name <- samp.df_957$sample_name
ord.DIV_RelA_stats.957$Location <- samp.df_957$Location

ggplot(ord.DIV_RelA_stats.957, aes(x = NMDS1, y = NMDS2)) + 
  geom_point(aes(colour = Location), size = 7) +
  #scale_color_manual(values=Mcap.Parent.colors)+
  #geom_text(label = rownames(scores), nudge_x = 0.05, nudge_y = 0.05,check_overlap = T) +
  ggtitle("NMDS its2 Bray Curtis 957") +
  theme_classic() 
#ggsave("bc_all.pdf")

ggplot(ord.DIV_RelA_stats.957, aes(x = NMDS1, y = NMDS2)) + 
  geom_point(aes(colour = Location), size = 4,show.legend=T) +
  #scale_Dolor_manual(values=Sp.Dolors)+
  # geom_text(label = rownames(Clade), nudge_x = 0.05, nudge_y = 0.05,check_overlap = T) +
  # stat_ellipse(aes(x = NMDS1, y = NMDS2, colour = Code),show.legend=T) +
  # geom_mark_ellipse(expand = 0,aes(fill=Location))+
    geom_mark_hull(expand = 0,aes(fill=Location))+

  ggtitle("NMDS its2 957 only ") +
  theme_classic()
#ggsave("bc_all.pdf")




#985 ####
DIV_RelA_stats_985<-subset_samples(coralDIV2.prune_stats, TagID=="985")
  DIV_RelA_stats_985 = prune_taxa(taxa_sums(DIV_RelA_stats_985) > 0, DIV_RelA_stats_985) #this removes any OTU with 0s

#all speices
set.seed(30)

#make bray curtis data matrix
bc.985 <- phyloseq::distance(coralDIV2.prune_stats, method = "bray")
  samp.df_985 <- as(sample_data(coralDIV2.prune_stats), "data.frame") #sample df
#adonis test
adonis(bc.985 ~ SampLoc, data = samp.df_985)


#Ordination NMDS for all species
set.seed(30)
ord.DIV_RelA_stats.985 <- ordinate(DIV_RelA_stats_985, "NMDS", "bray", trymax = 100) 
stressplot(ord.DIV_RelA_stats.985)
  samp.df_985 <- as(sample_data(DIV_RelA_stats_985), "data.frame") #sample df

ord.DIV_RelA_stats.985 <- as.data.frame(cbind(vegan::scores(ord.DIV_RelA_stats.985, display="sites"))) #make df
ord.DIV_RelA_stats.985$SampLoc <- samp.df_985$SampLoc
ord.DIV_RelA_stats.985$sample_name <- samp.df_985$sample_name
ord.DIV_RelA_stats.985$Location <- samp.df_985$Location

ggplot(ord.DIV_RelA_stats.985, aes(x = NMDS1, y = NMDS2)) + 
  geom_point(aes(colour = Location), size = 7) +
  #scale_color_manual(values=Mcap.Parent.colors)+
  #geom_text(label = rownames(scores), nudge_x = 0.05, nudge_y = 0.05,check_overlap = T) +
  ggtitle("NMDS its2 Bray Curtis 985") +
  theme_classic() 
#ggsave("bc_all.pdf")

ggplot(ord.DIV_RelA_stats.985, aes(x = NMDS1, y = NMDS2)) + 
  geom_point(aes(colour = Location), size = 4,show.legend=T) +
  #scale_Dolor_manual(values=Sp.Dolors)+
  # geom_text(label = rownames(Clade), nudge_x = 0.05, nudge_y = 0.05,check_overlap = T) +
  # stat_ellipse(aes(x = NMDS1, y = NMDS2, colour = Code),show.legend=T) +
  geom_mark_hull(expand = 0,aes(fill=Location))+
  ggtitle("NMDS its2 985 only ") +
  theme_classic()
#ggsave("bc_all.pdf")


#959 ####
DIV_RelA_stats_959<-subset_samples(coralDIV2.prune_stats, TagID=="959")
  DIV_RelA_stats_959 = prune_taxa(taxa_sums(DIV_RelA_stats_959) > 0, DIV_RelA_stats_959) #this removes any OTU with 0s

#all speices
set.seed(30)

#make bray curtis data matrix
bc.959 <- phyloseq::distance(coralDIV2.prune_stats, method = "bray")
  samp.df_959 <- as(sample_data(coralDIV2.prune_stats), "data.frame") #sample df
#adonis test
adonis(bc.959 ~ SampLoc, data = samp.df_959)


#Ordination NMDS for all species
set.seed(30)
ord.DIV_RelA_stats.959 <- ordinate(DIV_RelA_stats_959, "NMDS", "bray", trymax = 100) 
stressplot(ord.DIV_RelA_stats.959)
  samp.df_959 <- as(sample_data(DIV_RelA_stats_959), "data.frame") #sample df

ord.DIV_RelA_stats.959 <- as.data.frame(cbind(vegan::scores(ord.DIV_RelA_stats.959, display="sites"))) #make df
ord.DIV_RelA_stats.959$SampLoc <- samp.df_959$SampLoc
ord.DIV_RelA_stats.959$sample_name <- samp.df_959$sample_name
ord.DIV_RelA_stats.959$Sub.loc <- samp.df_959$Sub.loc
ord.DIV_RelA_stats.959$Code<-paste(ord.DIV_RelA_stats.959$SampLoc,ord.DIV_RelA_stats.959$Sub.loc)

ggplot(ord.DIV_RelA_stats.959, aes(x = NMDS1, y = NMDS2)) + 
  geom_point(aes(colour = Code), size = 7) +
  #scale_color_manual(values=Mcap.Parent.colors)+
  #geom_text(label = rownames(scores), nudge_x = 0.05, nudge_y = 0.05,check_overlap = T) +
  ggtitle("NMDS its2 Bray Curtis 959") +
  theme_classic() 
#ggsave("bc_all.pdf")

ggplot(ord.DIV_RelA_stats.959, aes(x = NMDS1, y = NMDS2)) + 
  geom_point(aes(colour = Sub.loc), size = 4,show.legend=T) +
  #scale_Dolor_manual(values=Sp.Dolors)+
  # geom_text(label = rownames(Clade), nudge_x = 0.05, nudge_y = 0.05,check_overlap = T) +
  # stat_ellipse(aes(x = NMDS1, y = NMDS2, colour = Code),show.legend=T) +
  geom_mark_hull(expand = 0,aes(fill=Sub.loc))+
  ggtitle("NMDS its2 959 only ") +
  theme_classic()
#ggsave("bc_all.pdf")


#961 ####
DIV_RelA_stats_961<-subset_samples(coralDIV2.prune_stats, TagID=="961")
  DIV_RelA_stats_961 = prune_taxa(taxa_sums(DIV_RelA_stats_961) > 0, DIV_RelA_stats_961) #this removes any OTU with 0s

#all speices
set.seed(30)

#make bray curtis data matrix
bc.961 <- phyloseq::distance(coralDIV2.prune_stats, method = "bray")
  samp.df_961 <- as(sample_data(coralDIV2.prune_stats), "data.frame") #sample df
#adonis test
adonis(bc.961 ~ SampLoc, data = samp.df_961)


#Ordination NMDS for all species
set.seed(30)
ord.DIV_RelA_stats.961 <- ordinate(DIV_RelA_stats_961, "NMDS", "bray", trymax = 100) 
stressplot(ord.DIV_RelA_stats.961)
  samp.df_961 <- as(sample_data(DIV_RelA_stats_961), "data.frame") #sample df

ord.DIV_RelA_stats.961 <- as.data.frame(cbind(vegan::scores(ord.DIV_RelA_stats.961, display="sites"))) #make df
ord.DIV_RelA_stats.961$SampLoc <- samp.df_961$SampLoc
ord.DIV_RelA_stats.961$sample_name <- samp.df_961$sample_name
ord.DIV_RelA_stats.961$Sub.loc <- samp.df_961$Sub.loc
ord.DIV_RelA_stats.961$Code<-paste(ord.DIV_RelA_stats.961$SampLoc,ord.DIV_RelA_stats.961$Sub.loc)

ggplot(ord.DIV_RelA_stats.961, aes(x = NMDS1, y = NMDS2)) + 
  geom_point(aes(colour = Code), size = 7) +
  #scale_color_manual(values=Mcap.Parent.colors)+
  #geom_text(label = rownames(scores), nudge_x = 0.05, nudge_y = 0.05,check_overlap = T) +
  ggtitle("NMDS its2 Bray Curtis 961") +
  theme_classic() 
#ggsave("bc_all.pdf")

ggplot(ord.DIV_RelA_stats.961, aes(x = NMDS1, y = NMDS2)) + 
  geom_point(aes(colour = Code), size = 4,show.legend=T) +
  #scale_Dolor_manual(values=Sp.Dolors)+
  # geom_text(label = rownames(Clade), nudge_x = 0.05, nudge_y = 0.05,check_overlap = T) +
  # stat_ellipse(aes(x = NMDS1, y = NMDS2, colour = Code),show.legend=T) +
  geom_mark_hull(expand = 0,aes(fill=Code))+
  ggtitle("NMDS its2 961 only ") +
  theme_classic()
#ggsave("bc_all.pdf")




######### Try by tips and bases only #### 
coralDIV2.prune_statsBranch<-subset_samples(coralDIV2.prune_stats, SampLoc=="Branch")
coralDIV2.prune_statsBranch = prune_taxa(taxa_sums(coralDIV2.prune_statsBranch) > 0, coralDIV2.prune_statsBranch)
  
set.seed(10)
ord.DIV_bc.Branch <- ordinate(coralDIV2.prune_statsBranch, "NMDS", "bray", trymax = 500)  ### NO CONVERGENCE
stressplot(ord.DIV_bc.Branch)
  samp.df.Branch <- as(sample_data(coralDIV2.prune_statsBranch), "data.frame") #sample df

ord.DIV_bc.Branch <- as.data.frame(cbind(vegan::scores(ord.DIV_bc.Branch, display="sites"))) #make df
ord.DIV_bc.Branch$TagID <- samp.df.Branch$TagID
ord.DIV_bc.Branch$TagID<-as.factor(ord.DIV_bc.Branch$TagID)
ord.DIV_bc.Branch$SampLoc <- samp.df.Branch$SampLoc
ord.DIV_bc.Branch$Location<-samp.df.Branch$Sub.loc
ord.DIV_bc.Branch$Code<-paste(ord.DIV_bc.Branch$SampLoc, ord.DIV_bc.Branch$Location)
ord.DIV_bc.Branch$Code<-as.factor(ord.DIV_bc.Branch$Code)

ggplot(ord.DIV_bc.Branch, aes(x = NMDS1, y = NMDS2)) + 
  geom_point(aes(colour = TagID), size = 4,show.legend=T) +
  #scaleBrancholor_manual(values=Sp.Brancholors)+
  # geom_text(label = rownames(Clade), nudge_x = 0.05, nudge_y = 0.05,check_overlap = T) +
  stat_ellipse(aes(x = NMDS1, y = NMDS2, colour = TagID),show.legend=T) +
  ggtitle("NMDS its2 C only ") +
  themeBranchlassic()
#ggsave("bc_all.pdf")
```


